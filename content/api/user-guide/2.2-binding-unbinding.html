<!DOCTYPE html>

<html lang="en">


    
    
        
    

<head>
    <meta charset="utf-8">
    <title>2.2 - Binding and unbinding &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/api.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
    <script src="https://www.apachecon.com/event-images/snippet.js"></script>
</head>

<body>
<div class="top-bottom-spacer"></div>
<div id="container">
    <div id="header">
    <span>Apache Directory</span>
    <a href="/"><div id="headerClick"></div></a>
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
             
                ApacheDS
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
            
                <strong>LDAP API</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <a class="acevent" data-format="wide" data-width="170"></a>
                <h5>LDAP API </h5>
                <ul>
                    <li><a href="/api/">Home</a></li>
                    <li><a href="/api/news.html">News</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/api/downloads-2.html">Version 2.1.7</a>&nbsp;&nbsp;<img src="/images/new_badge.svg" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/api/downloads-1.html">Version 1.0.3</a>&nbsp;&nbsp;</li>
                    <li><a href="/api/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Getting Started</h5>
                <ul>
                    <li><a href="/api/vision.html">Vision</a></li>
                    <li><a href="/api/java-api.html">Java API</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/api/five-minutes-tutorial.html">Five minute tutorial</a></li>
                    <li><a href="/api/user-guide.html">User Guide</a></li>
                    <li><a href="/api/migration-guide.html">API 1 to 2 migration</a></li>
                    <li><a href="/api/gen-docs/latest2/apidocs/">JavaDocs 2</a></li>
                    <li><a href="/api/gen-docs/latest/apidocs/">JavaDocs</a></li>
                    <li><a href="/api/gen-docs/latest2/xref/">Cross-Reference 2</a></li>
                    <li><a href="/api/gen-docs/latest/xref/">Cross-Reference</a></li>
                    
                    <li><a href="/api/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/api/internal-design-guide.html">Internal Guide</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="https://www.apache.org/">Apache</a></li>
    <li><a href="https://www.apache.org/licenses/">License</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="https://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="2.1-connection-disconnection.html">2.1 - Connection and disconnection</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="2-basic-ldap-api-usage.html">2 - Basic LDAP API usage</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="2.3-searching.html">2.3 Searching</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="22---binding-and-unbinding">2.2 - Binding and unbinding</h1>
<p>In <strong>LDAP</strong>, if one wants to access the server data, the common way to do it is to bind to the server. However, it&rsquo;s important to understand that binding is different from connecting.</p>
<p>Creating a connection to an <strong>LDAP</strong> server opens a socket between the client and the server. You must provide the address and the port in order to do this.</p>
<p>The <strong>bind</strong> operation, on the other hand, creates a <em>LdapSession</em> which will hold user&rsquo;s information for the duration of the session. This information are limited.</p>
<p>But it&rsquo;s important to know that it&rsquo;s possible to <em>bind</em> anonymously, which doesn&rsquo;t require a user or password, and still be able to send requests to the server (although the server can forbid anonymous binds).</p>
<p>Once the user has finished interacting with the server, they can <em>unbind</em>, destroying the session held on the server. This operation does not close the connection, because, again <em>bind != connection</em>!</p>
<h2 id="binding">Binding</h2>
<p>There are two possible types of binds in <em>LDAP</em>:</p>
<ul>
<li><strong>Simple</strong></li>
<li><strong>SASL</strong></li>
</ul>
<p>The first one is based on a user/password sent to the server, which verifies the credentials are valid. It&rsquo;s also possible to proceed with an anonymous bind explicitly.</p>
<p>The second type is more complicated, and is used whenever authentication uses a specific mechanism, like <strong>DIGEST-MD5</strong>, <strong>Kerberos</strong> or certificate based is required.</p>
<h3 id="simple-bind">Simple Bind</h3>
<p>One can issue three kinds of simple bind:</p>
<ul>
<li><em>anonymous bind</em></li>
<li><em>name/password bind</em></li>
<li><em>unauthenticated authentication bind</em></li>
</ul>
<p>The first one is the easiest, but depending on the server&rsquo;s configuration, will be accepted or rejected (not all servers allow anonymous binds)</p>
<p>Most of the time, the <em>bind</em> operation will not return anything but a success or an error result code. You either get bound, or will receive an <em>LdapException</em> if an error occurs, so there is no need to proceed with the returned <em>BindResponse</em>.</p>
<p>Issuing an anonymous bind is simple, you neither provide a user nor a password:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">testAnonymousBindRequest</span>()<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>Issuing a user/password bind is slightly more complex, because those credentials must be included:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">testSimpleBindRequest</span>()<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;uid=admin,ou=system&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;secret&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><blockquote>
<p><strong>Note</strong> It&rsquo;s important to note that the user&rsquo;s name is a <em><a href="6.9-dn.html">Dn</a></em>, not a simple name like &lsquo;John Doe&quot;</p>
</blockquote>
<p>Last, not least, there is a quite unknown feature in <strong>LDAP</strong> bind that allows you to issue a <em>Bind request</em> without providing a password. It&rsquo;s equivalent to an <em>anonymous</em> bind, except that the server can log the user&rsquo;s name, thus being able to trace what the user does. Servers might forbid such bind, and this will be the case if the server disallow anonymous binds.</p>
<p>Note that this kind of bind will be supported only if the server allows anonymous binds. It&rsquo;s not supported by <em>ApacheDS</em> by default.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">testSimpleBindRequest</span>()<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;uid=admin,ou=system&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="sasl-binding">SASL Binding</h3>
<p>There are various <strong>SASL</strong> mechanisms that can be used to bind to a <strong>LDAP</strong> server. The <strong>Apache LDAP API</strong> support the following 5 mechanisms:</p>
<h4 id="plain">PLAIN</h4>
<p>To be completed&hellip;</p>
<h4 id="cram-md5">CRAM-MD5</h4>
<p>To be completed&hellip;</p>
<h4 id="digest-md5">DIGEST-MD5</h4>
<p>To be completed&hellip;</p>
<h4 id="external">EXTERNAL</h4>
<p>To be completed&hellip;</p>
<h4 id="gssapi">GSSAPI</h4>
<p>First, non-trivial <strong>Kerberos</strong> authentication requires configuration. Creating a <strong>Kerberos</strong> configuration is not well documented elsewhere, so we include here sample code. One approach is to create a <strong>JAAS</strong> configuration file. Here’s what such a file might contain:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Text" data-lang="Text"><span style="display:flex;"><span>    myapp {
</span></span><span style="display:flex;"><span>     com.sun.security.auth.module.Krb5LoginModule required debug=true useKeyTab=true principal=&#34;host/ilab2.myorg.org@MYORG.ORG&#34; refreshKrb5Config=true keyTab=&#34;/etc/krb5.keytab&#34;;
</span></span><span style="display:flex;"><span>    };
</span></span></code></pre></div><p>See online documentation for <em>Krb5LoginModule</em> for possible options. This example uses the host’s principal, stored in <em>/etc/krb5.keytab</em>. What goes after <strong>@</strong> is the <strong>Kerberos</strong> domain name.</p>
<p>Note that if you specify a credential cache, the cache must be in a file. Many operating systems now put the user’s credentials in <strong>KEYRING</strong> or <strong>KCM</strong>. That worn’t work with Java.</p>
<p><em>“myapp”</em> is the name supplied as the login context name. See the code below.</p>
<p>When you run the program, you must tell java where the configuration file is. e.g. <em>“java -Djava.security.auth.login.config=jaas.config”</em>.</p>
<p>Here is code to connect to ldap with this configuration. We assume that <em>ldapNetworkConnection</em> has already been opened using connect.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>SaslGssApiRequest();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest.<span style="color:#b44">setLoginModuleConfiguration</span>(Configuration.<span style="color:#b44">getConfiguration</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest.<span style="color:#b44">setLoginContextName</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;myapp&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest.<span style="color:#b44">setMutualAuthentication</span>(<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">try</span><span style="color:#bbb">  </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>BindResponse<span style="color:#bbb"> </span>br<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>ldapNetworkConnection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span>saslGssApiRequest<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>ldapNetworkConnection.<span style="color:#b44">startTls</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">catch</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span>LdapException<span style="color:#bbb"> </span>e<span style="color:#bbb"> </span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>e.<span style="color:#b44">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>At this point you can do operations such as search. Note that the argument to <em>setLoginContextName</em> must match the name in the configuration file. This sample uses mutual authentication. It is possible that some <strong>LDAP</strong> servers might not support that. If so you can set it to false. You may not need <em>startTls</em> if the connection is already secure.</p>
<p>Sometimes it is more convenient to supply the configuration information programmatically. Here is an example that sets the same options as the config file</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">KerberosConfiguration</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">extends</span><span style="color:#bbb"> </span>Configuration<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span>AppConfigurationEntry<span style="color:#666">[]</span><span style="color:#bbb"> </span><span style="color:#00a000">getAppConfigurationEntry</span>(String<span style="color:#bbb"> </span>name)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>Map<span style="color:#666">&lt;</span>String,<span style="color:#bbb"> </span>String<span style="color:#666">&gt;</span><span style="color:#bbb"> </span>options<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>HashMap<span style="color:#666">&lt;</span>String,<span style="color:#bbb"> </span>String<span style="color:#666">&gt;</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>options.<span style="color:#b44">put</span>(<span style="color:#b44">&#34;useKeyTab&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">try</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>options.<span style="color:#b44">put</span>(<span style="color:#b44">&#34;principal&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;host/&#34;</span><span style="color:#bbb"> </span><span style="color:#666">+</span><span style="color:#bbb"> </span>InetAddress.<span style="color:#b44">getLocalHost</span>().<span style="color:#b44">getCanonicalHostName</span>()<span style="color:#bbb"> </span><span style="color:#666">+</span><span style="color:#bbb"> </span><span style="">“</span><span style="color:#a2f">@MYORG.ORG</span><span style="">”</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">catch</span><span style="color:#bbb"> </span>(Exception<span style="color:#bbb"> </span>e){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>System.<span style="color:#b44">out</span>.<span style="color:#b44">println</span>(<span style="color:#b44">&#34;Can&#39;t find our hostname &#34;</span><span style="color:#bbb"> </span><span style="color:#666">+</span><span style="color:#bbb"> </span>e);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>options.<span style="color:#b44">put</span>(<span style="color:#b44">&#34;refreshKrb5Config&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>options.<span style="color:#b44">put</span>(<span style="color:#b44">&#34;keyTab&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;/etc/krb5.keytab&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>options.<span style="color:#b44">put</span>(<span style="color:#b44">&#34;debug&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>AppConfigurationEntry<span style="color:#666">[]</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>AppConfigurationEntry(<span style="color:#b44">&#34;com.sun.security.auth.module.Krb5LoginModule&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                          </span>AppConfigurationEntry.<span style="color:#b44">LoginModuleControlFlag</span>.<span style="color:#b44">REQUIRED</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                          </span>options),};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>Here is how it is used:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>SaslGssApiRequest();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest.<span style="color:#b44">setLoginModuleConfiguration</span>(<span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>KerberosConfiguration());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>saslGssApiRequest.<span style="color:#b44">setMutualAuthentication</span>(<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">try</span><span style="color:#bbb">  </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>BindResponse<span style="color:#bbb"> </span>br<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>ldapNetworkConnection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span>saslGssApiRequest<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>ldapNetworkConnection.<span style="color:#b44">startTls</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">catch</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span>LdapException<span style="color:#bbb"> </span>e<span style="color:#bbb"> </span>)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>e.<span style="color:#b44">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>Note that it is not necessary to set the login context name, since it is only needed to process the configuration file.’</p>
<p>Warnings:</p>
<ul>
<li>
<p><strong>Apache Kerby</strong> does not implement the option to prompt the user for a password, nor does it permit a password to be passed to <strong>GSSAPI</strong>. Thus authentication is limited to key tables and credential caches.</p>
</li>
<li>
<p>The ** Apache Kerby** code sets two system properties. In the default case, it clears <strong>KRB5_CONF</strong> and sets <em>javax.security.auth.useSubjectCredsOnly</em> to true. If other code in your application uses <strong>Kerberos</strong>, be aware that there could be conflicts. Be particularly concerned about multi-threaded code that uses different values. Note that in Kirby you can explicitly set <strong>KRB5_CONF</strong>, with <em>setKrb5ConfFilePath</em>, or cause Kirby to set it with setRealmName, setKdcHost, and setKdcPort. If you use different settings for these options in different threads, there is a potential thread-safety issue.</p>
</li>
<li>
<p>The Java implementation of <strong>Kerberos</strong> has the ability to read standard <strong>Kerberos</strong> credential cache files, e.g. <em>/tmp/krb5cc</em>%{uid}<em>. However it can’t read credentials from <strong>KEYRING</strong> or <strong>KCM</strong>. If your code asks for authentication to come from an existing credential cache, make sure that it is in a file. If you write an application that expects to use existing credentials for logged in users, without prompting for a password, you may need to set <em>default_ccache_name</em> in <em>/etc/krb5.conf</em> to a file, e.g.
<em>default_ccache_name = /tmp/krb5cc</em>%{uid}</em>
This is not an issue if your authentication comes from key tables or prompts the user.</p>
</li>
<li>
<p>The encryption types supported depends upon the Java version. E,g. <em>aes128-cts-hmac-sha256-128</em> and <em>aes256-cts-hmac-sha384-192</em> are supported only as of Java 11.</p>
</li>
</ul>
<h2 id="rebinding">Rebinding</h2>
<p>It&rsquo;s possible to issue a <strong>Bind</strong> on an already bound connection and the existing <strong>LDAP</strong> session will be terminated, and replaced by a new <strong>LDAP</strong> session. In any case, the connection is not dropped when doing so. Note that if the connection was encrypted, it remains encrypted.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">testRebind</span>()<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;uid=admin,ou=system&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;secret&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">// Now, rebind</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;cn=john doe,dc=example,dc=com&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;secret&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>assertTrue(<span style="color:#bbb"> </span>connection.<span style="color:#b44">isConnected</span>()<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>assertTrue(<span style="color:#bbb"> </span>connection.<span style="color:#b44">isAuthenticated</span>()<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>If you issue a <em>bind</em> on the same connection with different credentials, then the existing session will be terminated on the server, and a new one will be created. All the pending requests for the initial session will be lost.</p>
<h2 id="unbinding">Unbinding</h2>
<p>This is a trivial operation : you just send an <strong>UnbindRequest</strong> to the server, which will invalidate your session.</p>
<p>It&rsquo;s important to know that when you issue an <strong>Unbind</strong>, the connection is dropped. It&rsquo;s done like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f">@Test</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">testUnbind</span>()<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;uid=admin,ou=system&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;secret&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">// Now, unbind</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">unBind</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>assertFalse(<span style="color:#bbb"> </span>connection.<span style="color:#b44">isConnected</span>()<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>assertFalse(<span style="color:#bbb"> </span>connection.<span style="color:#b44">isAuthenticated</span>()<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">// And Bind again.</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>connection.<span style="color:#b44">bind</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;uid=admin,ou=system&#34;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#34;secret&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><blockquote>
<p><strong>Note</strong> In this example, we have called the <em>unbind</em> operation, which has closed the connection. How is it possible that a <em>bind</em> operation can be applied on a closed connection? Actually, the <strong>LDAP API</strong> will automatically recreate a connection in this case.</p>
</blockquote>
<p>Last, but not least, if you close the connection, the session also terminates, without having to call <em>unbind</em>.</p>


            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="2.1-connection-disconnection.html">2.1 - Connection and disconnection</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="2-basic-ldap-api-usage.html">2 - Basic LDAP API usage</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="2.3-searching.html">2.3 Searching</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div class="footer-wrapper">
<div id="footer">
    &copy; 2003-2025, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple, Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>
</div>

</div>
<div class="top-bottom-spacer"></div>
</body>

</html>
