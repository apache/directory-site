<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>6.7 - Control &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/brown.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
</head>

<body>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
             
                ApacheDS
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
            
                <strong>LDAP API</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <h5>LDAP API </h5>
                <ul>
                    <li><a href="/api/">Home</a></li>
                    <li><a href="/api/news.html">News</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/api/downloads-2.html">Version 2.1.0</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/api/downloads-1.html">Version 1.0.3</a>&nbsp;&nbsp;</li>
                    <li><a href="/api/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Getting Started</h5>
                <ul>
                    <li><a href="/api/vision.html">Vision</a></li>
                    <li><a href="/api/java-api.html">Java API</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/api/five-minutes-tutorial.html">Five minute tutorial</a></li>
                    <li><a href="/api/user-guide.html">User Guide</a></li>
                    <li><a href="/api/migration-guide.html">API 1 to 2 migration</a></li>
                    <li><a href="/api/gen-docs/latest2/apidocs/">JavaDocs 2</a></li>
                    <li><a href="/api/gen-docs/latest/apidocs/">JavaDocs</a></li>
                    <li><a href="/api/gen-docs/latest2/xref/">Cross-Reference 2</a></li>
                    <li><a href="/api/gen-docs/latest/xref/">Cross-Reference</a></li>
                    
                    <li><a href="/api/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/api/internal-design-guide.html">Internal Guide</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="http://www.apache.org/">Apache</a></li>
    <li><a href="http://www.apache.org/licenses/">License</a></li>
    <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="http://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="6.6-csn.html">6.6 - Csn</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="6-ldap-data-structures.html">6 - LDAP data structures</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="6.8-cursor.html">6.8 - Cursor</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="67---control-">6.7 - Control (&hellip;)</h1>
<p>A <em>LDAP</em> <em>Control</em> is an extension to an operation. It tells the server to do something aside the standard operation, or it let the server send back some information to the client. A <em>Control</em> contains three different parts :</p>
<ul>
<li>An identifier, the control <em>OID</em></li>
<li>A flag telling the server what to do if it does not know about the control or if it results in an error (either return an error or ignore the control)</li>
<li>A value which is generally <em>BER</em> encoded</li>
</ul>
<p>There are many controls available, some being standardized, other being server specific.</p>
<p>One or more control can be added to any operation.</p>
<p>Note that either the client or the server might not know about the controls being used, and if the <em>criticality</em> flag is set to <em>FALSE</em>, the server will ignore the control in this case.</p>
<h2 id="managed-controls">Managed controls</h2>
<p>Here is the list of <em>control</em>s the LDAP API currently know about. The following short names are used to name the LDAP Servers that support each control.</p>
<ul>
<li>AP : ApacheDS</li>
<li>OL : OpenLDAP</li>
<li>AD :  Active Directory</li>
<li>OS : OpenDS</li>
<li>OJ : OpenDJ</li>
<li>UI : UnboundID</li>
<li>ID : IMB DS</li>
<li>All : all the servers</li>
</ul>
<p>The C/S column indicate if the control is sent to the server (S), or back to the client (C) or can be used both ways (C/S).</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>OID</th>
<th>Description</th>
<th>C/S</th>
<th>RFC</th>
<th>LDAP Servers</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#addirsync">AdDirSync</a></td>
<td>1.2.840.113556.1.4.841</td>
<td>Microsoft LDAP Control for Directory Synchronization</td>
<td>C/S</td>
<td><a href="http://tools.ietf.org/html/draft-armijo-ldap-dirsync-01">DIRSync draft</a></td>
<td>AD</td>
</tr>
<tr>
<td><a href="#adpolicyhints">AdPolicyHints</a></td>
<td>1.2.840.113556.1.4.223</td>
<td>Enforces the password history length constraint during password set</td>
<td>S</td>
<td><a href="https://msdn.microsoft.com/en-us/library/hh128228.aspx">LDAP_SERVER_POLICY_HINTS_OID</a></td>
<td>AD</td>
</tr>
<tr>
<td><a href="#adshowdeleted">AdShowDeleted</a></td>
<td>1.2.840.113556.1.4.417</td>
<td>DirSync search returns deleted entries</td>
<td>C</td>
<td><a href="https://msdn.microsoft.com/en-us/library/cc223326.aspx">LDAP_SERVER_SHOW_DELETED_OID</a></td>
<td>AD</td>
</tr>
<tr>
<td><a href="#cascade">Cascade</a></td>
<td>1.3.6.1.4.1.18060.0.0.1</td>
<td>Used to ask the server to delete an entry and all its descendants</td>
<td>S</td>
<td>None</td>
<td>AP</td>
</tr>
<tr>
<td><a href="#changenotifications">ChangeNotifications</a></td>
<td>1.2.840.113556.1.4.528</td>
<td>Registers the client to be notified when changes are made to an object in Active Directory.</td>
<td>S</td>
<td><a href="https://msdn.microsoft.com/en-us/library/cc223353.aspx">LDAP_SERVER_NOTIFICATION_OID</a></td>
<td>AD</td>
</tr>
<tr>
<td><a href="#entrychange">EntryChange</a></td>
<td>2.16.840.1.113730.3.4.7</td>
<td>Provides a simple mechanism by which an LDAP client can receive notification of changes that occur in an LDAP server</td>
<td>C</td>
<td><a href="https://www.ietf.org/proceedings/51/I-D/draft-ietf-ldapext-psearch-03.txt">Persistent Search: A Simple LDAP Change Notification Mechanism</a></td>
<td>AP</td>
</tr>
<tr>
<td><a href="#managedsait">ManageDSAIT</a></td>
<td>2.16.840.1.113730.3.4.2</td>
<td>Allows access to management objects as standard objects</td>
<td>S</td>
<td><a href="https://www.ietf.org/rfc/rfc3296.txt">RFC 3296</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#pagedresults">PagedResults</a></td>
<td>1.2.840.113556.1.4.319</td>
<td>A request/response control used to implement a simple paging of search results</td>
<td>C/S</td>
<td><a href="http://www.faqs.org/rfcs/rfc2696.html">RFC 2696</a></td>
<td>All</td>
</tr>
<tr>
<td><a href="#passwordpolicy">PasswordPolicy</a></td>
<td>1.3.6.1.4.1.42.2.27.8.5.1</td>
<td>The password policy control</td>
<td>C/S</td>
<td><a href="https://tools.ietf.org/html/draft-behera-ldap-password-policy-10">PasswordPolicy draft</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#permissivemodify">PermissiveModify</a></td>
<td>1.2.840.113556.1.4.1413</td>
<td>Allows an LDAP modify to work under less restrictive conditions</td>
<td>S</td>
<td><a href="https://msdn.microsoft.com/en-us/library/cc223352.aspx">LDAP_SERVER_PERMISSIVE_MODIFY_OID</a></td>
<td>AD</td>
</tr>
<tr>
<td><a href="#persistentsearch">PersistentSearch</a></td>
<td>2.16.840.1.113730.3.4.3</td>
<td>Provides a simple mechanism by which an LDAP client can receive notification of changes that occur in an LDAP server</td>
<td>S</td>
<td><a href="https://tools.ietf.org/html/draft-ietf-ldapext-psearch-03">Persistent Search</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#proxiedauthz">ProxiedAuthz</a></td>
<td>2.16.840.1.113730.3.4.18</td>
<td>Defines the Proxy Authorization request</td>
<td>S</td>
<td><a href="https://tools.ietf.org/html/rfc4370">RFC 4370</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#sortrequest">SortRequest</a></td>
<td>1.2.840.113556.1.4.473</td>
<td>Server Side Sort request control</td>
<td>S</td>
<td><a href="http://tools.ietf.org/html/rfc2891">RFC 2891</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#sortresponse">SortResponse</a></td>
<td>1.2.840.113556.1.4.474</td>
<td>Server Side Sort request control</td>
<td>C</td>
<td><a href="http://tools.ietf.org/html/rfc2891">RFC 2891</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#subentries">Subentries</a></td>
<td>1.3.6.1.4.1.4203.1.10.1</td>
<td>Controls the visibility of entries and subentries</td>
<td>S</td>
<td><a href="http://tools.ietf.org/html/rfc3672">RFC 3672</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#syncdonevalue">SyncDoneValue</a></td>
<td>1.3.6.1.4.1.4203.1.9.1.3</td>
<td>Control sent when replication has been completed. It contains a cookie.</td>
<td>C</td>
<td><a href="https://tools.ietf.org/html/rfc4533">RFC 4533</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#syncrequestvalue">SyncRequestValue</a></td>
<td>1.3.6.1.4.1.4203.1.9.1.1</td>
<td>Controls the syncrepl process</td>
<td>S</td>
<td><a href="https://tools.ietf.org/html/rfc4533">RFC 4533</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#syncstatevalue">SyncStateValue</a></td>
<td>1.3.6.1.4.1.4203.1.9.1.2</td>
<td>Gives the syncrepl state</td>
<td>C</td>
<td><a href="https://tools.ietf.org/html/rfc4533">RFC 4533</a></td>
<td>AP/OL</td>
</tr>
<tr>
<td><a href="#virtuallistviewrequest">VirtualListViewRequest</a></td>
<td>2.16.840.1.113730.3.4.9</td>
<td>Sent to the server to request a subset of results</td>
<td>S</td>
<td><a href="https://tools.ietf.org/html/draft-ietf-ldapext-ldapv3-vlv-09">Scrolling View Browsing of Search Results</a></td>
<td>AP</td>
</tr>
<tr>
<td><a href="#virtuallistviewresponse">VirtualListViewResponse</a></td>
<td>2.16.840.1.113730.3.4.10</td>
<td>Sent back to the client to give the search current status</td>
<td>C</td>
<td><a href="https://tools.ietf.org/html/draft-ietf-ldapext-ldapv3-vlv-09">Scrolling View Browsing of Search Results</a></td>
<td>AP</td>
</tr>
</tbody>
</table>
<h2 id="how-to-use-controls">How to use controls</h2>
<p>It&rsquo;s quite simple. You just have to instanciate the control you want to use, set its value, and add it to the request you will send to the server. Here is an example with the <em>ManageDsaIT</em> control :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java">    AddRequest addRequest <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> AddRequestImpl<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>       <span style="color:#080;font-style:italic">// Create the request
</span><span style="color:#080;font-style:italic"></span>    ManageDsaIT manageDSAIT <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> ManageDsaITImpl<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>    <span style="color:#080;font-style:italic">// Instanciate the control
</span><span style="color:#080;font-style:italic"></span>    manageDSAIT<span style="color:#666">.</span><span style="color:#b44">setCritical</span><span style="color:#666">(</span> <span style="color:#a2f;font-weight:bold">true</span> <span style="color:#666">)</span><span style="color:#666">;</span>                    <span style="color:#080;font-style:italic">// Set a value
</span><span style="color:#080;font-style:italic"></span>    addRequest<span style="color:#666">.</span><span style="color:#b44">addControl</span><span style="color:#666">(</span> manageDSAIT <span style="color:#666">)</span><span style="color:#666">;</span>               <span style="color:#080;font-style:italic">// Add the control to the request
</span><span style="color:#080;font-style:italic"></span>    <span style="color:#666">.</span><span style="color:#666">.</span><span style="color:#666">.</span>
</code></pre></div><p>and that&rsquo;s it !</p>
<p>Note that you have to create an instance of teh operation you want to send to the server, if yu want to add a control to it.</p>
<p>On the client side, you may want to check if there is a control and read it if so. This is a bit more complex, because you need to know which kind of control you are expecting. We will see with a more complex control, the <em>Paged Search</em> control (which allows the user to get a specific number of enries at each call). Here, we will fetch 4 entries in one go, until all the entries have been read, and as we have 10 entries to read, we will send 3 <em>SearchRequest</em>, teh first two will return 4 entries and the last one only 2.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java">    <span style="color:#a2f;font-weight:bold">try</span> <span style="color:#666">(</span> LdapConnection connection <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> LdapNetworkConnection<span style="color:#666">(</span> <span style="color:#b44">&#34;MyServer&#34;</span><span style="color:#666">,</span> 389 <span style="color:#666">)</span> <span style="color:#666">)</span>
    <span style="color:#666">{</span>
        connection<span style="color:#666">.</span><span style="color:#b44">bind</span><span style="color:#666">(</span> <span style="color:#b44">&#34;cn=user,ou=system&#34;</span><span style="color:#666">,</span> <span style="color:#b44">&#34;secret&#34;</span> <span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// Create the control, and tell it we want 4 entries for every call
</span><span style="color:#080;font-style:italic"></span>        PagedResults pagedControl <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> PagedResultsImpl<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        pagedControl<span style="color:#666">.</span><span style="color:#b44">setSize</span><span style="color:#666">(</span> 4 <span style="color:#666">)</span><span style="color:#666">;</span>
    
        <span style="color:#080;font-style:italic">// Read all the elements
</span><span style="color:#080;font-style:italic"></span>        List<span style="color:#666">&lt;</span>Entry<span style="color:#666">&gt;</span> results <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> ArrayList<span style="color:#666">&lt;</span><span style="color:#666">&gt;</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// Create the SearchRequest
</span><span style="color:#080;font-style:italic"></span>        SearchRequest searchRequest <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> SearchRequestImpl<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        searchRequest<span style="color:#666">.</span><span style="color:#b44">setBase</span><span style="color:#666">(</span> <span style="color:#a2f;font-weight:bold">new</span> Dn<span style="color:#666">(</span> <span style="color:#b44">&#34;dc=users,ou=system&#34;</span> <span style="color:#666">)</span> <span style="color:#666">)</span><span style="color:#666">;</span>
        searchRequest<span style="color:#666">.</span><span style="color:#b44">setFilter</span><span style="color:#666">(</span> <span style="color:#b44">&#34;(cn=*)&#34;</span> <span style="color:#666">)</span><span style="color:#666">;</span>
        searchRequest<span style="color:#666">.</span><span style="color:#b44">setScope</span><span style="color:#666">(</span> SearchScope<span style="color:#666">.</span><span style="color:#b44">SUBTREE</span> <span style="color:#666">)</span><span style="color:#666">;</span>
    
        <span style="color:#a2f;font-weight:bold">while</span> <span style="color:#666">(</span> <span style="color:#a2f;font-weight:bold">true</span> <span style="color:#666">)</span>
        <span style="color:#666">{</span>
            <span style="color:#080;font-style:italic">// Add the PagedSearch control to the SearchRequest
</span><span style="color:#080;font-style:italic"></span>            searchRequest<span style="color:#666">.</span><span style="color:#b44">addControl</span><span style="color:#666">(</span> pagedControl <span style="color:#666">)</span><span style="color:#666">;</span>
                
            <span style="color:#080;font-style:italic">// Do the search now
</span><span style="color:#080;font-style:italic"></span>            <span style="color:#a2f;font-weight:bold">try</span> <span style="color:#666">(</span> SearchCursor cursor <span style="color:#666">=</span> connection<span style="color:#666">.</span><span style="color:#b44">search</span><span style="color:#666">(</span> searchRequest <span style="color:#666">)</span> <span style="color:#666">)</span>
            <span style="color:#666">{</span>
                <span style="color:#080;font-style:italic">// Loop on all the entries we got back (Should be 4, or less)
</span><span style="color:#080;font-style:italic"></span>                <span style="color:#a2f;font-weight:bold">while</span> <span style="color:#666">(</span> cursor<span style="color:#666">.</span><span style="color:#b44">next</span><span style="color:#666">(</span><span style="color:#666">)</span> <span style="color:#666">)</span>
                <span style="color:#666">{</span>
                    Entry result <span style="color:#666">=</span> cursor<span style="color:#666">.</span><span style="color:#b44">getEntry</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
                    results<span style="color:#666">.</span><span style="color:#b44">add</span><span style="color:#666">(</span> result <span style="color:#666">)</span><span style="color:#666">;</span>
                <span style="color:#666">}</span>

                <span style="color:#080;font-style:italic">// Check if we have reached the size limit
</span><span style="color:#080;font-style:italic"></span>                <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span> cursor<span style="color:#666">.</span><span style="color:#b44">getSearchResultDone</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">.</span><span style="color:#b44">getLdapResult</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">.</span><span style="color:#b44">getResultCode</span><span style="color:#666">(</span><span style="color:#666">)</span> <span style="color:#666">=</span><span style="color:#666">=</span> ResultCodeEnum<span style="color:#666">.</span><span style="color:#b44">SIZE_LIMIT_EXCEEDED</span> <span style="color:#666">)</span>
                <span style="color:#666">{</span>
                    <span style="color:#a2f;font-weight:bold">break</span><span style="color:#666">;</span>
                <span style="color:#666">}</span>
        
                <span style="color:#080;font-style:italic">// Now check the returned controls
</span><span style="color:#080;font-style:italic"></span>                Map<span style="color:#666">&lt;</span>String<span style="color:#666">,</span> Control<span style="color:#666">&gt;</span> controls <span style="color:#666">=</span>  cursor<span style="color:#666">.</span><span style="color:#b44">getSearchResultDone</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">.</span><span style="color:#b44">getControls</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>

                <span style="color:#080;font-style:italic">// We should get a PagedResult response
</span><span style="color:#080;font-style:italic"></span>                PagedResults responseControl <span style="color:#666">=</span> <span style="color:#666">(</span> PagedResults <span style="color:#666">)</span> controls<span style="color:#666">.</span><span style="color:#b44">get</span><span style="color:#666">(</span> PagedResults<span style="color:#666">.</span><span style="color:#b44">OID</span> <span style="color:#666">)</span><span style="color:#666">;</span>

                <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span> responseControl <span style="color:#666">!</span><span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">null</span> <span style="color:#666">)</span>
                <span style="color:#666">{</span>
                    <span style="color:#080;font-style:italic">// check if this is over, ie the cookie is empty
</span><span style="color:#080;font-style:italic"></span>                    <span style="color:#0b0;font-weight:bold">byte</span><span style="color:#666">[</span><span style="color:#666">]</span> cookie <span style="color:#666">=</span> responseControl<span style="color:#666">.</span><span style="color:#b44">getCookie</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
                
                    <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span> Strings<span style="color:#666">.</span><span style="color:#b44">isEmpty</span><span style="color:#666">(</span> cookie <span style="color:#666">)</span> <span style="color:#666">)</span>
                    <span style="color:#666">{</span>
                        <span style="color:#080;font-style:italic">// Ok, we are done
</span><span style="color:#080;font-style:italic"></span>                        <span style="color:#a2f;font-weight:bold">break</span><span style="color:#666">;</span>
                    <span style="color:#666">}</span>

                    <span style="color:#080;font-style:italic">// Prepare the next iteration, sending a bad cookie
</span><span style="color:#080;font-style:italic"></span>                    pagedControl<span style="color:#666">.</span><span style="color:#b44">setCookie</span><span style="color:#666">(</span> cookie <span style="color:#666">)</span><span style="color:#666">;</span>
                <span style="color:#666">}</span>
                <span style="color:#a2f;font-weight:bold">else</span>
                <span style="color:#666">{</span>
                    <span style="color:#a2f;font-weight:bold">break</span><span style="color:#666">;</span>
                <span style="color:#666">}</span>
            <span style="color:#666">}</span>
        <span style="color:#666">}</span>

        <span style="color:#080;font-style:italic">// At this point, we should have read 10 entries
</span><span style="color:#080;font-style:italic"></span>    <span style="color:#666">}</span>
</code></pre></div><p>This sounds like a bit complex, but actually, this control is complex. What we are interested in is the way we get the control returned by the server. In this case, the control we are interested in is attached to the <em>SearchResultDone</em> response, which is the last result we have when reading the cursor. As we may have more than one control, the response conains a <em>Map</em> of controls, ot of which we should be able to retreive the <em>PagedSearch</em> control from its <em>OID</em>. This is what does this piece of code :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java">                <span style="color:#666">.</span><span style="color:#666">.</span><span style="color:#666">.</span>
                <span style="color:#080;font-style:italic">// We should get a PagedResult response
</span><span style="color:#080;font-style:italic"></span>                PagedResults responseControl <span style="color:#666">=</span> <span style="color:#666">(</span> PagedResults <span style="color:#666">)</span> controls<span style="color:#666">.</span><span style="color:#b44">get</span><span style="color:#666">(</span> PagedResults<span style="color:#666">.</span><span style="color:#b44">OID</span> <span style="color:#666">)</span><span style="color:#666">;</span>
                <span style="color:#666">.</span><span style="color:#666">.</span><span style="color:#666">.</span>
</code></pre></div><p>If it&rsquo;s not null, we can proceed with the control.</p>
<p>Side note : in this piece of code, we don&rsquo;t close the connection nor the cursor, because they are <em>Closeable</em> : They will be close when we exit the <em>try</em> scope. This is a feature added in <em>Java 7</em>, called <em>try with resources</em></p>
<h2 id="managed-controls-detail">Managed Controls detail</h2>
<h3 id="addirsync">AdDirSync</h3>
<p>A control used to initiate a synchronization with an <em>Active Directory</em> server, and get back the results. Check <a href="https://tools.ietf.org/html/draft-armijo-ldap-dirsync-01">Microsoft LDAP Control for Directory Synchronization</a> for a better understanding on how to use this control.</p>
<ul>
<li>OID : <em>1.2.840.113556.1.4.841</em></li>
<li>Criticality : TRUE</li>
<li>ASN.1 description :</li>
</ul>
<p>Sent to the server :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Text" data-lang="Text">    realReplControlValue ::= SEQUENCE {
        flags                 integer
        maxBytes              integer
        cookie                OCTET STRING
    }
</code></pre></div><p>This control is only valid when send with a <em>SearchRequest</em>.</p>
<p>Received from the server :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Text" data-lang="Text">    realReplControlValue ::= SEQUENCE {
        flag                  integer
        maxReturnLength       integer
        cookie                OCTET STRING
    }
</code></pre></div><p>The cookie read from this control has to be injected in the control sent to the server for the next search.</p>
<h3 id="adpolicyhints">AdPolicyHints</h3>
<ul>
<li>OID : 1.2.840.113556.1.4.223</li>
</ul>
<h3 id="adshowdeleted">AdShowDeleted</h3>
<ul>
<li>OID : 1.2.840.113556.1.4.417</li>
</ul>
<h3 id="cascade">Cascade</h3>
<ul>
<li>OID : 1.3.6.1.4.1.18060.0.0.1</li>
</ul>
<h3 id="changenotifications">ChangeNotifications</h3>
<ul>
<li>OID : 1.2.840.113556.1.4.528</li>
</ul>
<h3 id="entrychange">EntryChange</h3>
<ul>
<li>OID : 2.16.840.1.113730.3.4.7</li>
</ul>
<h3 id="managedsait">ManageDSAIT</h3>
<ul>
<li>OID : <em>2.16.840.1.113730.3.4.2</em></li>
</ul>
<p>This is oe of the simplest control : it has no value, and he criticality flag may be absent.</p>
<p>It&rsquo;s used to get access to special objects, like <em>referrals</em> or <em>subentries</em> as normal objects. Let&rsquo;s see what that means for <em>referrals</em>.</p>
<p>A  <em>Referral</em> is a special object which once returned to the client, will automatically will redirect the client to another part of teh <em>DIT</em> (or to another <em>LDAP</em> server). So to speak, the end user does not see the <em>referral</em>, but the reffered entry. The question is : how do we set a <em>referral</em>, or how do we modify it ? We use the <em>ManageDsaIT</em> control.</p>
<p>Let say we have such an entry, which is actually a referal :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Text" data-lang="Text">    dn: uid=entryRef,ou=users,dc=acme,dc=com
    objectClass: extensibleObject
    objectClass: referral
    objectClass: top
    uid: entryref
    ref: ldap://localhost:10389/uid=entry,ou=users,dc=acme,dc=com
    ref: ldap://trust:10389/uid=entry,ou=users,dc=trust,dc=com
</code></pre></div><p>A client searchingg for <em>uid=entryRef,ou=users,dc=acme,dc=com</em> will be redirected to <em>uid=entry,ou=users,dc=acme,dc=com</em> on the local server or on <em>uid=entry,ou=users,dc=trust,dc=com</em> on the <em>trust</em> server (it&rsquo;s up to the client to decide which entry to fetch).</p>
<p>If we want to modify this referral, we need to add the <em>ManageDsaIT</em> control :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java">    <span style="color:#a2f;font-weight:bold">try</span> <span style="color:#666">(</span> LdapConnection connection <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> LdapNetworkConnection<span style="color:#666">(</span> <span style="color:#b44">&#34;MyServer&#34;</span><span style="color:#666">,</span> 389 <span style="color:#666">)</span> <span style="color:#666">)</span>
    <span style="color:#666">{</span>
        connection<span style="color:#666">.</span><span style="color:#b44">bind</span><span style="color:#666">(</span> <span style="color:#b44">&#34;cn=user,ou=system&#34;</span><span style="color:#666">,</span> <span style="color:#b44">&#34;secret&#34;</span> <span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// modify the referral 
</span><span style="color:#080;font-style:italic"></span>        ModifyRequest modifyRequest <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> ModifyRequestImpl<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        modifyRequest<span style="color:#666">.</span><span style="color:#b44">setName</span><span style="color:#666">(</span> <span style="color:#a2f;font-weight:bold">new</span> Dn<span style="color:#666">(</span> <span style="color:#b44">&#34;uid=entryRef,ou=users,dc=acme,dc=com&#34;</span> <span style="color:#666">)</span> <span style="color:#666">)</span><span style="color:#666">;</span>
        modifyRequest<span style="color:#666">.</span><span style="color:#b44">add</span><span style="color:#666">(</span> <span style="color:#b44">&#34;ref&#34;</span><span style="color:#666">,</span> <span style="color:#b44">&#34;ldap://subsidiary:10389/uid=entry,ou=users,dc=subsidiary,dc=com&#34;</span> <span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// Add the control
</span><span style="color:#080;font-style:italic"></span>        modifyRequest<span style="color:#666">.</span><span style="color:#b44">addControl</span><span style="color:#666">(</span> <span style="color:#a2f;font-weight:bold">new</span> ManageDsaITImpl<span style="color:#666">(</span><span style="color:#666">)</span> <span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// And apply the modification
</span><span style="color:#080;font-style:italic"></span>        connection<span style="color:#666">.</span><span style="color:#b44">modify</span><span style="color:#666">(</span> modifyRequest <span style="color:#666">)</span><span style="color:#666">;</span>
    <span style="color:#666">}</span>
</code></pre></div><p>Now, if we fetch the entry (still using the control), it will looks like :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Text" data-lang="Text">    dn: uid=entryRef,ou=users,dc=acme,dc=com
    objectClass: extensibleObject
    objectClass: referral
    objectClass: top
    uid: entryref
    ref: ldap://localhost:10389/uid=entry,ou=users,dc=acme,dc=com
    ref: ldap://trust:10389/uid=entry,ou=users,dc=trust,dc=com
    ref: ldap://subsidiary:10389/uid=entry,ou=users,dc=subsidiary,dc=com
</code></pre></div><p>As you can see, a third <em>ref</em> value has been added.</p>
<h3 id="pagedresults">PagedResults</h3>
<ul>
<li>OID : <em>1.2.840.113556.1.4.319</em></li>
</ul>
<h3 id="passwordpolicy">PasswordPolicy</h3>
<ul>
<li>OID : 1.3.6.1.4.1.42.2.27.8.5.1</li>
</ul>
<h3 id="permissivemodify">PermissiveModify</h3>
<ul>
<li>OID : 1.2.840.113556.1.4.1413</li>
</ul>
<h3 id="persistentsearch">PersistentSearch</h3>
<ul>
<li>OID : 2.16.840.1.113730.3.4.3</li>
</ul>
<h3 id="proxiedauthz">ProxiedAuthz</h3>
<ul>
<li>OID : 2.16.840.1.113730.3.4.18</li>
</ul>
<h3 id="sortrequest">SortRequest</h3>
<ul>
<li>OID : 1.2.840.113556.1.4.473</li>
</ul>
<h3 id="sortresponse">SortResponse</h3>
<ul>
<li>OID : 1.2.840.113556.1.4.474</li>
</ul>
<h3 id="subentries">Subentries</h3>
<ul>
<li>OID : 1.3.6.1.4.1.4203.1.10.1</li>
</ul>
<h3 id="syncdonevalue">SyncDoneValue</h3>
<ul>
<li>OID : 1.3.6.1.4.1.4203.1.9.1.3</li>
</ul>
<h3 id="syncrequestvalue">SyncRequestValue</h3>
<ul>
<li>OID : 1.3.6.1.4.1.4203.1.9.1.1</li>
</ul>
<h3 id="syncstatevalue">SyncStateValue</h3>
<ul>
<li>OID : 1.3.6.1.4.1.4203.1.9.1.2</li>
</ul>
<h3 id="virtuallistviewrequest">VirtualListViewRequest</h3>
<ul>
<li>OID : 2.16.840.1.113730.3.4.9</li>
</ul>
<h3 id="virtuallistviewresponse">VirtualListViewResponse</h3>
<ul>
<li>OID : 2.16.840.1.113730.3.4.10</li>
</ul>


            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="6.6-csn.html">6.6 - Csn</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="6-ldap-data-structures.html">6 - LDAP data structures</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="6.8-cursor.html">6.8 - Cursor</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2021, <a href="http://www.apache.org">The Apache Software Foundation</a> - <a href="/privacy-policy.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
