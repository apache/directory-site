<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>3.2 - Basic authorization &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/green.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
</head>

<body>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
            
                <strong>ApacheDS</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <h5>ApacheDS 2.0</h5>
                <ul>
                    <li><a href="/apacheds/">Home</a></li>
                    <li><a href="/apacheds/news.html">News</a></li>
                    <li><a href="/apacheds/features.html">Features</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/apacheds/downloads.html">ApacheDS 2.0.0.AM26</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/apacheds/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/apacheds/basic-user-guide.html">Basic User Guide </a></li>
                    <li><a href="/apacheds/advanced-user-guide.html">Advanced User Guide</a></li>
                    <li><a href="/apacheds/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/apacheds/kerberos-user-guide.html">Kerberos User Guide</a></li>
                    <li><a href="/apacheds/configuration/ads-2.0-configuration.html">Configuration</a></li>
                    <li><a href="/apacheds/gen-docs/latest/apidocs">JavaDocs</a></li>
                    <li><a href="/apacheds/gen-docs/latest/xref">Cross-Reference</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="http://www.apache.org/">Apache</a></li>
    <li><a href="http://www.apache.org/licenses/">License</a></li>
    <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="http://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="3.1-authentication-options.html">3.1 - Authentication options</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="3-basic-security.html">3 - Basic Security</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="3.3-enabling-ssl.html">3.3 - How to enable SSL</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="32---basic-authorization">3.2 - Basic authorization</h1>
<p>This section describes the default authorization functionality of ApacheDS 1.5, which is very simple. On the other hand, it is inadequate for most serious deployments. Therefore a basic example to the &ldquo;real&rdquo; authorization subsystem is provided as well.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-authorization">What is authorization?</a>
      <ul>
        <li><a href="#authorization-for-directory-operations-vs-group-membership">Authorization for directory operations vs. group membership</a></li>
      </ul>
    </li>
    <li><a href="#default-authorization-behavior-for-directory-operations">Default authorization behavior for directory operations</a>
      <ul>
        <li><a href="#sample-data-within-ouusersousystem">Sample data within &ldquo;ou=users,ou=system&rdquo;</a></li>
        <li><a href="#rules-and-sample-operations">Rules and sample operations</a></li>
        <li><a href="#is-this-sufficient">Is this sufficient?</a></li>
      </ul>
    </li>
    <li><a href="#simple-example-for-the-aci-subsystem">Simple example for the ACI subsystem</a>
      <ul>
        <li><a href="#requirements-met">Requirements met</a></li>
        <li><a href="#enable-the-aci-subsystem">Enable the ACI Subsystem</a></li>
        <li><a href="#further-configuration-tasks-to-perform-afterwards">Further configuration tasks to perform afterwards</a></li>
        <li><a href="#ldif-for-this-configuration">LDIF for this configuration</a></li>
      </ul>
    </li>
    <li><a href="#verification-that-it-works">Verification, that it works</a>
      <ul>
        <li><a href="#performing-some-search-operations-in-order-to-read-data">Performing some search operations in order to read data</a></li>
        <li><a href="#trying-to-manipulate-data">Trying to manipulate data</a></li>
      </ul>
    </li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
<h2 id="what-is-authorization">What is authorization?</h2>
<p>After authentication of a user or an application (or more generally an LDAP client) against the directory server (or attaining anonymous access respectively), certain LDAP operations will be granted or rejected, according to configuration and certain rules. This process of granting access is called authorization.</p>
<p>Authorization for directory operations is not strictly standardized in the LDAP world, <a href="http://www.faqs.org/rfcs/rfc2829.html">RFC 2829 - Authentication Methods for LDAP</a> describes various scenarios and concepts, but does not enforce a concrete implementation. Thus each product comes with its own authorization feature. So does ApacheDS. A powerful authorization subsystem is provided since version 0.9.3, but disabled as a default.</p>
<h3 id="authorization-for-directory-operations-vs-group-membership">Authorization for directory operations vs. group membership</h3>
<p>In order to accomplish their authorization functionality, software components often take advantage of LDAP groups stored within the directory. <em>groupOfNames</em> and <em>groupOfUniqueNames</em> are common object classes for groups entries; they contain the DNs of their members (users, other groups) as attribute values.</p>
<p>In order to illustrate this, the &ldquo;Seven Seas&rdquo; example partition contains such group entries below &ldquo;ou=groups,o=sevenSeas&rdquo;. Here the entry of a group describing the HMS Bounty crew (before the mutiny) in LDIF format.</p>
<pre><code>dn: cn=HMS Bounty,ou=crews,ou=groups,o=sevenSeas
objectclass: groupOfUniqueNames
objectclass: top
cn: HMS Bounty
uniquemember: cn=William Bligh,ou=people,o=sevenSeas
uniquemember: cn=Fletcher Christian,ou=people,o=sevenSeas
uniquemember: cn=John Fryer,ou=people,o=sevenSeas
...
</code></pre>
<p>In such a scenario, a user, who is directly or indirectly member of a certain group is permitted to do something. The software component acts as a normal LDAP client and determines group belonging with the help of ordinary search operations. This is widely used but has nothing to do with the authorization for directory operations as described in this section (except that the client needs the permission to search the data). Learn more about best practices in this area in the article <a href="http://www.nmi-edit.org/CAMP/EDIT_IdM/docs/internet2-mace-dir-groups-best-practices-200210.htm">Practices in Directory Groups</a>. Further examples in this guide are the Tomcat and Apache HTTPD integration sections.</p>
<h2 id="default-authorization-behavior-for-directory-operations">Default authorization behavior for directory operations</h2>
<p>Without access controls enabled all entries are accessible and alterable by all: even anonymous users. There are however some minimal built-in rules for protecting users and groups within the server without having to turn on the ACI subsystem.</p>
<h3 id="sample-data-within-ouusersousystem">Sample data within &ldquo;ou=users,ou=system&rdquo;</h3>
<p>In addition to our brave sailors below <em>ou=people,o=sevenSeas</em>, assume the following to entries present within <em>ou=users,ou=system</em>:</p>
<p><img src="images/authorization-sample-entries.png" alt="Authorization Sample Entries"></p>
<pre><code>dn: cn=Tori Amos,ou=users,ou=system
objectclass: person
objectclass: top
sn: Amos
cn: Tori Amos
userpassword: amos

dn: cn=Kate Bush,ou=users,ou=system
objectclass: person
objectclass: top
sn: Bush
cn: Kate Bush
userpassword: bush
</code></pre>
<p>They are used in the following examples, in conjunction with <em>o=sevenSeas</em>, to describe the default authorization rules.</p>
<h3 id="rules-and-sample-operations">Rules and sample operations</h3>
<p>Without ACIs the server automatically protects, hides, the admin user from everyone but the admin user. Here a sample search operation in order to demonstrate this protection. The same command is submitted three times with different users.</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;uid=admin,ou=system&quot; -w secret \\
    -b &quot;ou=system&quot; -s one &quot;(uid=admin)&quot; dn
version: 1
dn: uid=admin,ou=system

$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\
    -b &quot;ou=system&quot; -s one &quot;(uid=admin)&quot; dn
	
$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Tori Amos,ou=users,ou=system&quot; -w amos \\
    -b &quot;ou=system&quot; -s one &quot;(uid=admin)&quot; dn
	
$
</code></pre>
<p>Users cannot see other user entries under the &lsquo;ou=users,ou=system&rsquo; entry. So placing new users there automatically protects them. Placing new users anywhere else exposes them.</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;uid=admin,ou=system&quot; -w secret \\
    -b &quot;ou=users,ou=system&quot; -s one &quot;(objectclass=*)&quot; dn
version: 1
dn: cn=Tori Amos,ou=users,ou=system

dn: cn=Kate Bush,ou=users,ou=system

$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Kate Bush,ou=users,ou=system&quot; -w bush \\
    -b &quot;ou=users,ou=system&quot; -s one &quot;(objectclass=*)&quot; dn
version: 1
dn: cn=Kate Bush,ou=users,ou=system

$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\
    -b &quot;ou=users,ou=system&quot; -s one &quot;(objectclass=*)&quot; dn
	
$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\
    -b &quot;ou=people,o=sevenSeas&quot; -s one &quot;(objectclass=*)&quot; dn
version: 1
dn: cn=Horatio Hornblower,ou=people,o=sevenSeas

dn: cn=William Bush,ou=people,o=sevenSeas

dn: cn=Thomas Masterman Hardy,ou=people,o=sevenSeas

dn: cn=Cornelius Buckley,ou=people,o=sevenSeas

dn: cn=William Bligh,ou=people,o=sevenSeas
...
$
</code></pre>
<p>Groups defined using <em>groupOfNames</em> or <em>groupOfUniqueNames</em> under the &lsquo;ou=groups,ou=system&rsquo; are also protected from access or alteration by anyone other than the admin user. Again this protection is not allowed anywhere else but under these entries.</p>
<h3 id="is-this-sufficient">Is this sufficient?</h3>
<p>For simple configurations the described rules should provide adequate protection but it lacks flexibility. For advanced configurations users should enable the ACI subsystem. This however shuts down access to everything by everyone except the admin user which bypasses the ACI subsystem. Directory administrators should look at the documentation on how to specify access control information in the Advanced User&rsquo;s Guide.</p>
<h2 id="simple-example-for-the-aci-subsystem">Simple example for the ACI subsystem</h2>
<p>As an appetizer for the stunning ACI subsystem (ACI = access control item) within ApacheDS, we provide a simple yet realistic example. It manifests the following requirements</p>
<h3 id="requirements-met">Requirements met</h3>
<ul>
<li>Suffix &ldquo;o=sevenSeas&rdquo; used as Access Control Specific Area</li>
<li>User &ldquo;cn=Horatio Nelson,ou=people,o=sevenSeas&rdquo; should be able to perform all operations (delete, add, &hellip;) below the base &ldquo;o=sevenSeas&rdquo;</li>
<li>Other users and anonymous users should only be able to search and compare (no add, modify etc.)</li>
<li>Other users and anonymous users should not be able to read the userPassword attribute</li>
</ul>
<h3 id="enable-the-aci-subsystem">Enable the ACI Subsystem</h3>
<p>The authorization (ACI) subsystem is disabled by default. It is recommended that you enable it using the <em>Apache Directory Studio</em> configuration editor as follows :</p>
<p><img src="images/enable-access-control.png" alt="Enable access control"></p>
<p>However, ACI subsystem can also be enabled with an ldapmodify operation. <a href="../advanced-ug/4.2.3-enabling-access-control.html">This technique discussed in the Advanced User Guide</a>.</p>
<p>A restart of the server is necessary for this change to take effect.</p>
<h3 id="further-configuration-tasks-to-perform-afterwards">Further configuration tasks to perform afterwards</h3>
<ol>
<li>Create an operational attribute <em>administrativeRole</em> with value &ldquo;accessControlSpecificArea&rdquo; in the entry &ldquo;o=sevenSeas&rdquo;.</li>
<li>Create a subentry subordinate to &ldquo;o=sevenSeas&rdquo; to grant all operations&rsquo; permissions to &ldquo;cn=Horatio Nelson,ou=people,o=sevenSeas&rdquo;, who acts as directory manager</li>
</ol>
<p>The subentry should contain the following attributes and values:</p>
<pre><code>cn=&quot;sevenSeasAuthorizationRequirementsACISubentry&quot;
subtreeSpecification=&quot;{}&quot;
prescriptiveACI=&quot;{
               identificationTag &quot;directoryManagerFullAccessACI&quot;,
               precedence 11,
               authenticationLevel simple,
               itemOrUserFirst userFirst:
               {
                 userClasses
                 {
                   name { &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; }
                 },
                 userPermissions
                 { 
                   {
                     protectedItems
                     {
                       entry, allUserAttributeTypesAndValues
                     },
                     grantsAndDenials
                     {
                       grantAdd, grantDiscloseOnError, grantRead,
                       grantRemove, grantBrowse, grantExport, grantImport,
                       grantModify, grantRename, grantReturnDN,
                       grantCompare, grantFilterMatch, grantInvoke
                     } 
                   }
                 }
               } 
             }&quot;
</code></pre>
<ol start="3">
<li>A new attribute value should added to the previously created Subentry&rsquo;s prescriptiveACI attribute to grant search and compare permissions to all users.</li>
</ol>
<p>The new value:</p>
<pre><code>prescriptiveACI=&quot;{
               identificationTag &quot;allUsersSearchAndCompareACI&quot;,
               precedence 10,
               authenticationLevel simple,
               itemOrUserFirst userFirst:
               {
                 userClasses
                 {
                   allUsers
                 },
                 userPermissions
                 { 
                   {
                     protectedItems
                     {
                       entry, allUserAttributeTypesAndValues
                     },
                     grantsAndDenials
                     {
                       grantRead, grantBrowse, grantReturnDN,
                       grantCompare, grantFilterMatch, grantDiscloseOnError 
                     } 
                   }
                 }
               } 
             }&quot;
</code></pre>
<ol start="4">
<li>A new attribute value should added to the previously created Subentry&rsquo;s prescriptiveACI attribute to deny search and compare permissions for <em>userPassword</em> attribute to all users.</li>
</ol>
<p>The new value:</p>
<pre><code>prescriptiveACI=&quot;{
               identificationTag &quot;preventAllUsersFromReadingUserPasswordAttributeACI&quot;,
               precedence 10,
               authenticationLevel simple,
               itemOrUserFirst userFirst:
               {
                 userClasses
                 {
                   allUsers
                 },
                 userPermissions
                 { 
                   {
                     protectedItems
                     {
                       attributeType { userPassword }
                     },
                     grantsAndDenials
                     {
                       denyRead, denyCompare, denyFilterMatch
                     } 
                   }
                 }
               } 
             }&quot;
</code></pre>
<p>The two values given in 3 and 4 can be combined in a single value as:</p>
<pre><code>prescriptiveACI=&quot;{
               identificationTag &quot;allUsersACI&quot;,
               precedence 10,
               authenticationLevel none,
               itemOrUserFirst userFirst:
               {
                 userClasses
                 {
                   allUsers
                 },
                 userPermissions
                 { 
                   {
                     protectedItems { entry, allUserAttributeTypesAndValues },
                     grantsAndDenials { grantRead, grantBrowse, grantReturnDN,
                                        grantCompare, grantFilterMatch, grantDiscloseOnError } 
                   },
                   {
                     protectedItems { attributeType { userPassword } },
                     grantsAndDenials { denyRead, denyCompare, denyFilterMatch }
                   }
                 }
               } 
             }&quot;
</code></pre>
<h3 id="ldif-for-this-configuration">LDIF for this configuration</h3>
<p>The following LDIF file ([^authz_sevenSeas.ldif]) provides a set of changes made to directory entries in the &ldquo;Seven Seas&rdquo; data. In total it performs the steps described above.</p>
<pre><code># File authz_sevenSeas.ldif
#
# Create an operational attribute &quot;administrativeRole&quot;
# with value &quot;accessControlSpecificArea&quot; in the entry &quot;o=sevenSeas&quot;.
#
dn: o=sevenSeas
changetype: modify
add: administrativeRole
administrativeRole: accessControlSpecificArea

# Create a subentry subordinate to &quot;o=sevenSeas&quot; to grant all operations' permissions 
# to &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot;, to grant search and compare permissions
# to all users and to deny search and compare permissions for userPassword attribute to all users. 
#
dn: cn=sevenSeasAuthorizationRequirementsACISubentry,o=sevenSeas
changetype: add
objectclass: top
objectclass: subentry
objectclass: accessControlSubentry
cn: sevenSeasAuthorizationRequirementsACISubentry
subtreeSpecification: {}
prescriptiveACI: {
    identificationTag &quot;directoryManagerFullAccessACI&quot;,
    precedence 11,
    authenticationLevel simple,
    itemOrUserFirst userFirst:
    {
        userClasses
        {
            name { &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; }
        },
        userPermissions
        { 
            {
                protectedItems
                {
                    entry, allUserAttributeTypesAndValues
                },
                grantsAndDenials
                {
                    grantAdd, grantDiscloseOnError, grantRead,
                    grantRemove, grantBrowse, grantExport, grantImport,
                    grantModify, grantRename, grantReturnDN,
                    grantCompare, grantFilterMatch, grantInvoke
                } 
            }
        }
    } 
}
prescriptiveACI: {
    identificationTag &quot;allUsersACI&quot;,
    precedence 10,
    authenticationLevel none,
    itemOrUserFirst userFirst:
    {
        userClasses
        {
            allUsers
        },
        userPermissions
        { 
            {
                protectedItems { entry, allUserAttributeTypesAndValues },
                grantsAndDenials { grantRead, grantBrowse, grantReturnDN,
                         grantCompare, grantFilterMatch, grantDiscloseOnError } 
            },
            {
                protectedItems { attributeType { userPassword } },
                grantsAndDenials { denyRead, denyCompare, denyFilterMatch }
            }
        }	
    }
  }
</code></pre>
<p>To apply this configuration to the sample data partition, you can perform an <em>ldapmodify</em> with the LDIF as agrument:</p>
<pre><code>$ ldapmodify -h zanzibar -p 10389 -D &quot;uid=admin,ou=system&quot; -w secret -f authz_sevenSeas.ldif
modifying entry o=sevenSeas

adding new entry cn=sevenSeasAuthorizationRequirementsACISubentry,o=sevenSeas
$
</code></pre>
<p>It is also possible to use graphical tools; some of them offer the feature to perform operations given in LDIF.</p>
<h2 id="verification-that-it-works">Verification, that it works</h2>
<p>After successfully applying the changes to the sample partition, one may ask how to check whether it works. We therefore perform some operations with the help of command line tools. Some will be permitted, some will not (and cause an appropriate error message). It would also be able to check this with the help of graphical tools (you might like to do this instead). But it is easier to document the parameters used with the help command line arguments.</p>
<h3 id="performing-some-search-operations-in-order-to-read-data">Performing some search operations in order to read data</h3>
<p>Bind as user &ldquo;William Bush&rdquo; and search for entries which match &ldquo;(uid=hhornblo)&quot;. Expected behavior: We are able to read the attributes of entry &ldquo;cn=Horatio Hornblower,ou=people,o=sevenSeas&rdquo; (the only entry which matches the filter). The password attribute should not be visible. It works as desired:</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\
    -b &quot;o=sevenSeas&quot; -s sub &quot;(uid=hhornblo)&quot;
version: 1
dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
mail: hhornblo@royalnavy.mod.uk
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
objectclass: top
cn: Horatio Hornblower
uid: hhornblo
givenname: Horatio
description: Capt. Horatio Hornblower, R.N
sn: Hornblower
</code></pre>
<p>In the described configuration, the user &ldquo;Horatio Nelson&rdquo; acts as a directory manager below &ldquo;o=sevenSeas&rdquo;. Hence he should basically be allowed to do everything. He should even be able to see other users&rsquo; <em>userPassword</em> values. In our case, the hash function <em>SHA</em> was applied to them:</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; -w pass \\
    -b &quot;o=sevenSeas&quot; -s sub &quot;(objectclass=person)&quot; uid userPassword
version: 1
dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
userpassword: {SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=
uid: hhornblo

dn: cn=William Bush,ou=people,o=sevenSeas
userpassword: {SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=
uid: wbush

dn: cn=Thomas Quist,ou=people,o=sevenSeas
userpassword: {SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=
uid: tquist
...
</code></pre>
<p>But &ldquo;Horation Nelson&rdquo; is not able to perform searches in other areas than &ldquo;o=sevenSeas&rdquo; to see the entries. Of course our global ApacheDS administrator &ldquo;uid=admin,ou=system&rdquo; is still able to see them:</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; -w pass \\
    -b &quot;ou=system&quot; -s sub &quot;(objectclass=person)&quot;
	
$ ldapsearch -h zanzibar -p 10389 -D &quot;uid=admin,ou=system&quot; -w secret \\
    -b &quot;ou=system&quot; -s sub &quot;(objectclass=person)&quot;
version: 1
dn: uid=admin,ou=system
sn: administrator
cn: system administrator
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
userpassword: secret
uid: admin
displayName: Directory Superuser

dn: cn=Tori Amos,ou=users,ou=system
cn: Tori Amos
userpassword: amos
objectclass: person
objectclass: top
sn: Amos
...
</code></pre>
<h3 id="trying-to-manipulate-data">Trying to manipulate data</h3>
<p>Until now the authorization only hided data (entries, attributes) from users with insufficient access rights. Let&rsquo;s perform some operations which try to manipulate the directory data!</p>
<h4 id="adding-an-entry">Adding an entry</h4>
<p>First we try to add a new user to the &ldquo;Seven Seas&rdquo; partition. The data for the entry is inspired by &ldquo;Peter Pan&rdquo; and provided by this LDIF file (<a href="resources/captain-hook.ldif">Captain hook</a>):</p>
<pre><code># File captain_hook.ldif
dn: cn=James Hook,ou=people,o=sevenSeas
objectclass: inetOrgPerson
objectclass: organizationalPerson
objectclass: person
objectclass: top
cn: James Hook
description: A pirate captain and Peter Pan's nemesis
sn: Hook
mail: jhook@neverland
userpassword: peterPan
</code></pre>
<p>An anonymous user is not allowed to create new entries, as the following error message shows:</p>
<pre><code>$ ldapmodify -h zanzibar -p 10389 -a -f captain_hook.ldif
adding new entry cn=James Hook,ou=people,o=sevenSeas
ldap_add: Insufficient access
ldap_add: additional info: failed to add entry cn=James Hook,ou=people,o=sevenSeas: null
$
</code></pre>
<p>The same holds true for all &ldquo;Seven Seas&rdquo;-user other than &ldquo;Horatio Nelson&rdquo;. The latter is permitted to do so:</p>
<pre><code>$ ldapmodify -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\
    -a -f captain_hook.ldif
adding new entry cn=James Hook,ou=people,o=sevenSeas
ldap_add: Insufficient access
ldap_add: additional info: failed to add entry cn=James Hook,ou=people,o=sevenSeas: null
	
$ ldapmodify -h zanzibar -p 10389 -D &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; -w pass \\
    -a -f captain_hook.ldif
adding new entry cn=James Hook,ou=people,o=sevenSeas
$
</code></pre>
<p>Afterwards a new entry is successfully created within the &ldquo;Seven Seas&rdquo; partition by user &ldquo;Horatio Nelson&rdquo;. The &lsquo;+&rsquo; sign in the attributes list of the <em>ldapsearch</em> command causes ApacheDS to return the operational attributes, which demonstrate this.</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -b &quot;o=sevenSeas&quot; -s sub &quot;(cn=James Hook)&quot; +
version: 1
dn: cn=James Hook,ou=people,o=sevenSeas
accessControlSubentries: cn=sevenSeasAuthorizationRequirementsACISubentry,o=sevenSeas
creatorsName: cn=Horatio Nelson,ou=people,o=sevenSeas
createTimestamp: 20061203140109Z
</code></pre>
<h4 id="modifying-an-entry">Modifying an entry</h4>
<p>As a further example which tries to write to the directory, we add a new value to the description attribute of the freshly created entry for Captain Hook. With a change entry in an LDIF file, it looks like this (file <a href="resources/captain-hook-modify.ldif">Captain Hook</a>):</p>
<pre><code># File captain_hook_modify.ldif
dn: cn=James Hook,ou=people,o=sevenSeas
changetype: modify
add: description
description: Wears an iron hook in place of his right hand
-
</code></pre>
<p>Performing the modification with the <em>ldapmodify</em> command line tool again fails for users other than &ldquo;Horation Nelson&rdquo; (who is allowed to due to the authorization configuration) and &ldquo;uid=admin,ou=system&rdquo;.</p>
<pre><code>$ ldapmodify -h zanzibar -p 10389 -f captain_hook_modify.ldif
modifying entry cn=James Hook,ou=people,o=sevenSeas
ldap_modify: Insufficient access
ldap_modify: additional info: failed to modify entry cn=James Hook,ou=people,o=sevenSeas: null

$ ldapmodify -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\ 
    -f captain_hook_modify.ldif
modifying entry cn=James Hook,ou=people,o=sevenSeas
ldap_modify: Insufficient access
ldap_modify: additional info: failed to modify entry cn=James Hook,ou=people,o=sevenSeas: null

$ ldapmodify -h zanzibar -p 10389 -D &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; -w pass \\
    -f captain_hook_modify.ldif
modifying entry cn=James Hook,ou=people,o=sevenSeas
</code></pre>
<h4 id="deleting-an-entry">Deleting an entry</h4>
<p>Now it is finale time. A demonstration on how to delete the villain&rsquo;s entry from the directory. With an LDIF file (<a href="resources/captain-hook-delete.ldif">Captain hook delete</a>) with an appropriate change entry, this can easily be accomplished, if the bind user is allowed to do so.</p>
<pre><code># File captain_hook_delete.ldif
dn: cn=James Hook,ou=people,o=sevenSeas
changetype: delete
</code></pre>
<p>Applying this file with the help of <em>ldapmodify</em> results in a behavior comparable to the modification. Anonymous or &ldquo;normal&rdquo; users (like &ldquo;William Bush&rdquo;) are not permitted to delete Captain Hook&rsquo;s entry. The user &ldquo;Horatio Nelson&rdquo;, our directory manager for &ldquo;Seven Seas&rdquo;, is:</p>
<pre><code>$ ldapmodify -h zanzibar -p 10389 -f captain_hook_delete.ldif
deleting entry cn=James Hook,ou=people,o=sevenSeas
ldap_delete: Insufficient access
ldap_delete: additional info: failed to delete entry cn=James Hook,ou=people,o=sevenSeas: null

$ ldapmodify -h zanzibar -p 10389 -D &quot;cn=William Bush,ou=people,o=sevenSeas&quot; -w pass \\
    -f captain_hook_delete.ldif
deleting entry cn=James Hook,ou=people,o=sevenSeas
ldap_delete: Insufficient access
ldap_delete: additional info: failed to delete entry cn=James Hook,ou=people,o=sevenSeas: null

$ ldapmodify -h zanzibar -p 10389 -D &quot;cn=Horatio Nelson,ou=people,o=sevenSeas&quot; -w pass \\
    -f captain_hook_delete.ldif
deleting entry cn=James Hook,ou=people,o=sevenSeas
$
</code></pre>
<p>The entry &ldquo;cn=James Hook,ou=people,o=sevenSeas&rdquo; has been successfully deleted from the partition. Our little demonstration on how the ACI subsystem with a realistic configuration behaves end here. Learn more about it in the Advanced User&rsquo;s Guide.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="http://middleware.internet2.edu/dir/groups/docs/internet2-mace-dir-groups-best-practices-200210.htm">Practices in Directory Groups</a> describes how to use groups within LDAP directories. Highly recommended.</li>
<li>The <a href="../advanced-ug.html">ApacheDS v1.0 Advanced User&rsquo;s Guide</a> provides a detailed authorization chapter</li>
<li><a href="http://www.faqs.org/rfcs/rfc2849.html">RFC 2849</a> The LDAP Data Interchange Format (LDIF) is used extensively in this section</li>
</ul>


            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="3.1-authentication-options.html">3.1 - Authentication options</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="3-basic-security.html">3 - Basic Security</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="3.3-enabling-ssl.html">3.3 - How to enable SSL</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2020, <a href="http://www.apache.org">The Apache Software Foundation</a> - <a href="/privacy-policy.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
