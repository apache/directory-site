<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>3.1 - Authentication options &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/green.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
</head>

<body>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
            
                <strong>ApacheDS</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <h5>ApacheDS 2.0</h5>
                <ul>
                    <li><a href="/apacheds/">Home</a></li>
                    <li><a href="/apacheds/news.html">News</a></li>
                    <li><a href="/apacheds/features.html">Features</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/apacheds/downloads.html">ApacheDS 2.0.0.AM26</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/apacheds/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/apacheds/basic-user-guide.html">Basic User Guide </a></li>
                    <li><a href="/apacheds/advanced-user-guide.html">Advanced User Guide</a></li>
                    <li><a href="/apacheds/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/apacheds/kerberos-user-guide.html">Kerberos User Guide</a></li>
                    <li><a href="/apacheds/configuration/ads-2.0-configuration.html">Configuration</a></li>
                    <li><a href="/apacheds/gen-docs/latest/apidocs">JavaDocs</a></li>
                    <li><a href="/apacheds/gen-docs/latest/xref">Cross-Reference</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="http://www.apache.org/">Apache</a></li>
    <li><a href="http://www.apache.org/licenses/">License</a></li>
    <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="http://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="3-basic-security.html">3 - Basic Security</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="3-basic-security.html">3 - Basic Security</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="3.2-basic-authorization.html">3.2 - Basic authorization</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="31---authentication-options">3.1 - Authentication options</h1>
<p>This section describes the authentication options of ApacheDS 2.0. Anonymous and simple binds are supported, as well as SASL mechanisms. Configuring and using the first two of them is described below with the help of examples.</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-authentication">What is authentication?</a></li>
    <li><a href="#simple-binds">Simple binds</a>
      <ul>
        <li><a href="#using-command-line-tools">Using command line tools</a></li>
        <li><a href="#binds-from-java-components-using-jndi">Binds from Java components using JNDI</a></li>
      </ul>
    </li>
    <li><a href="#passwords-stored-one-way-encrypted">Passwords stored one-way encrypted</a>
      <ul>
        <li><a href="#passwords-not-stored-in-clear-text">Passwords not stored in clear text</a></li>
        <li><a href="#but-how-to-obtain-the-hash-value-for-a-password">But how to obtain the hash value for a password?</a></li>
        <li><a href="#from-an-ldap-client-point-of-view">From an LDAP client point of view</a></li>
      </ul>
    </li>
    <li><a href="#anonymous-binds">Anonymous binds</a>
      <ul>
        <li><a href="#enabledisable-anonymous-binds">Enable/disable anonymous binds</a></li>
        <li><a href="#example-server-behavior-with-anonymous-binds-disabled">Example: Server behavior with anonymous binds disabled</a></li>
        <li><a href="#example-server-behavior-with-anonymous-binds-enabled">Example: Server behavior with anonymous binds enabled</a></li>
        <li><a href="#other-clients">Other clients</a></li>
      </ul>
    </li>
    <li><a href="#how-to-authenticate-a-user-by-uid-and-password">How to authenticate a user by uid and password?</a>
      <ul>
        <li><a href="#an-algorithm">An algorithm</a></li>
        <li><a href="#sample-code-with-jndi">Sample code with JNDI</a></li>
      </ul>
    </li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
<h2 id="what-is-authentication">What is authentication?</h2>
<p><em>Authentication</em> is the process of determining whether someone (or something) in fact is what he/she/it asserts to be.</p>
<p>Within ApacheDS you will likely want to authenticate clients in order to check whether they are allowed to read, add or manipulate certain data stored within the directory. The latter, i.e. whether an authenticated client is permitted to do something, is deduced during <em>authorization</em>.</p>
<p>Quite often, the process of authentication is delegated to a directory service by other software components. Because in doing so, authentication data (e.g. username, password) and authorization data (e.g. group relationships) are stored and managed centrally in the directory, and all connected software solutions benefit from it. The integration sections of this guide provide examples for Apache Tomcat, Apache HTTP servers, and others.</p>
<p>ApacheDS 2.0 supports simple authentication and anonymous binds while storing passwords within <em>userPassword</em> attributes in user entries. Passwords can be stored in clear text or one-way encrypted with a hash algorithm like MD5 or SHA1. Since version 1.5.1, SASL mechanism are supported as well. We start with anonymous binds.</p>
<h2 id="simple-binds">Simple binds</h2>
<p>Authentication via simple bind is widely used. The method is supported by ApacheDS 2.0 for all person entries stored within any partition, if they contain a password attribute. How does it work? An LDAP client provides the DN of a user entry and a password to the server, the parameters of the bind operation. ApacheDS checks whether the given password is the same as the one stored in the <em>userpassword</em> attribute of the given entry. If not, the bind operation fails (LDAP error code 49, LDAP_INVALID_CREDENTIALS), and the user is not authenticated.</p>
<h3 id="using-command-line-tools">Using command line tools</h3>
<p>Assume this entry from the Seven Seas partition is stored within the directory (only a fragment with the relevant attributes is shown).</p>
<pre><code>dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
objectclass: person
objectclass: organizationalPerson
cn: Horatio Hornblower
sn: Hornblower
userpassword: pass
...
</code></pre>
<p>In the following search command, a user tries to bind with the given DN (option -D) but a wrong password (option -w). The bind fails and the command terminates without performing the search.</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Horatio Hornblower,ou=people,o=sevenSeas&quot; \\
    -w wrong -b &quot;ou=people,o=sevenSeas&quot; -s base &quot;(objectclass=*)&quot;
ldap_simple_bind: Invalid credentials
ldap_simple_bind: additional info: Bind failed: null
</code></pre>
<p>If the user provides the correct password during the call of the ldapsearch command, the bind operation succeeds and the seach operation is performed afterwards.</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Horatio Hornblower,ou=people,o=sevenSeas&quot; \\
    -w pass -b &quot;ou=people,o=sevenSeas&quot; -s base &quot;(objectclass=*)&quot;
version: 1
dn: ou=people,o=sevenSeas
ou: people
description: Contains entries which describe persons (seamen)
objectclass: organizationalUnit
objectclass: top
</code></pre>
<h3 id="binds-from-java-components-using-jndi">Binds from Java components using JNDI</h3>
<p>Using JNDI, authentication via simple binds is accomplished by appropriate configuration. One option is to provide the parameters in a Hashtable object like this</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">java.util.Hashtable</span><span style="color:#666">;</span>

<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.Context</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.InitialContext</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.NamingEnumeration</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.NamingException</span><span style="color:#666">;</span>

<span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">SimpleBindDemo</span> <span style="color:#666">{</span>
    
    <span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">static</span> <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">main</span><span style="color:#666">(</span>String<span style="color:#666">[</span><span style="color:#666">]</span> args<span style="color:#666">)</span> <span style="color:#a2f;font-weight:bold">throws</span> NamingException <span style="color:#666">{</span>
        
        <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span>args<span style="color:#666">.</span><span style="color:#b44">length</span> <span style="color:#666">&lt;</span> 2<span style="color:#666">)</span> <span style="color:#666">{</span>
            System<span style="color:#666">.</span><span style="color:#b44">err</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span><span style="color:#b44">&#34;Usage: java SimpleBindDemo &lt;userDN&gt; &lt;password&gt;&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
            System<span style="color:#666">.</span><span style="color:#b44">exit</span><span style="color:#666">(</span>1<span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span>
        
        Hashtable env <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> Hashtable<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">INITIAL_CONTEXT_FACTORY</span><span style="color:#666">,</span> <span style="color:#b44">&#34;com.sun.jndi.ldap.LdapCtxFactory&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">PROVIDER_URL</span><span style="color:#666">,</span> <span style="color:#b44">&#34;ldap://zanzibar:10389/o=sevenSeas&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
        
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">SECURITY_AUTHENTICATION</span><span style="color:#666">,</span> <span style="color:#b44">&#34;simple&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">SECURITY_PRINCIPAL</span><span style="color:#666">,</span> args<span style="color:#666">[</span>0<span style="color:#666">]</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">SECURITY_CREDENTIALS</span><span style="color:#666">,</span> args<span style="color:#666">[</span>1<span style="color:#666">]</span><span style="color:#666">)</span><span style="color:#666">;</span>
        
        <span style="color:#a2f;font-weight:bold">try</span> <span style="color:#666">{</span>
            Context ctx <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> InitialContext<span style="color:#666">(</span>env<span style="color:#666">)</span><span style="color:#666">;</span>
            NamingEnumeration enm <span style="color:#666">=</span> ctx<span style="color:#666">.</span><span style="color:#b44">list</span><span style="color:#666">(</span><span style="color:#b44">&#34;&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
            
            <span style="color:#a2f;font-weight:bold">while</span> <span style="color:#666">(</span>enm<span style="color:#666">.</span><span style="color:#b44">hasMore</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span> <span style="color:#666">{</span>
                System<span style="color:#666">.</span><span style="color:#b44">out</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span>enm<span style="color:#666">.</span><span style="color:#b44">next</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>
            <span style="color:#666">}</span>
            
            enm<span style="color:#666">.</span><span style="color:#b44">close</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
            ctx<span style="color:#666">.</span><span style="color:#b44">close</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span> <span style="color:#a2f;font-weight:bold">catch</span> <span style="color:#666">(</span>NamingException e<span style="color:#666">)</span> <span style="color:#666">{</span>
            System<span style="color:#666">.</span><span style="color:#b44">out</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span>e<span style="color:#666">.</span><span style="color:#b44">getMessage</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span>
    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>If the DN of a user entry and the fitting password are provided as command line arguments, the program binds successfully and performs a search:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ java SimpleBindDemo <span style="color:#b44">&#34;cn=Horatio Hornblower,ou=people,o=sevenSeas&#34;</span> pass
<span style="color:#b8860b">ou</span><span style="color:#666">=</span>people: javax.naming.directory.DirContext
<span style="color:#b8860b">ou</span><span style="color:#666">=</span>groups: javax.naming.directory.DirContext
</code></pre></div><p>On the other hand, providing an incorrect password results in a failed bind operation. JNDI maps it to a <em>NamingException</em>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ java SimpleBindDemo <span style="color:#b44">&#34;cn=Horatio Hornblower,ou=people,o=sevenSeas&#34;</span> quatsch
<span style="color:#666">[</span>LDAP: error code <span style="color:#666">49</span> - Bind failed: null<span style="color:#666">]</span>
</code></pre></div><p>In real life, you obviously want to separate most of the configuration data from the source code, for instance with the help of the <em>jndi.properties</em> file.</p>
<h2 id="passwords-stored-one-way-encrypted">Passwords stored one-way encrypted</h2>
<p>If passwords are stored in the directory in clear like above, the administrator (<em>uid=admin,ou=system</em>) is able to read them. This holds true even if authorization is enabled. The passwords would also be visible in exported LDIF files. This is often unacceptable.</p>
<DIV class="warning" markdown="1">
Not only the administrator will be able to read your password, or be visible in LDIF files, but if one does not use SSL, the password is transmitted in clear text above the wire...
</DIV>
<h3 id="passwords-not-stored-in-clear-text">Passwords not stored in clear text</h3>
<p>ApacheDS does also support simple binds, if user passwords are stored one-way encrypted. An LDAP client, which creates user entries, applies a hash-function (SHA for instance) to the user passwords beforehand, and stores the users with these fingerprints as <em>userpassword</em> values (instead of the clear text values), for instance:</p>
<pre><code>dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
objectclass: person
objectclass: organizationalPerson
cn: Horatio Hornblower
sn: Hornblower
userpassword: {SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=
...
</code></pre>
<p>The value &ldquo;{SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=&rdquo; means that <em>SHA</em> (Secure Hash Algorithm) was applied to the password, and &ldquo;nU4eI71bcnBGqeO0t9tXvY1u5oQ=&rdquo; was the result (Base-64 encoded). Please note that it is not possible to calculate the source (&ldquo;pass&rdquo; in our case) back from the result. This is why it is called one-way encrypted &ndash; it is rather difficult to decrypt it. One may guess many times, calculate the hash values (the algorithms are public) and compare the result. But this would take a long time, especially if you choose a more complex password than we did (&ldquo;pass&rdquo;).</p>
<h3 id="but-how-to-obtain-the-hash-value-for-a-password">But how to obtain the hash value for a password?</h3>
<p>With some lines of code, it is quite easy to accomplish this task programatically in Java:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">java.security.MessageDigest</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">java.security.NoSuchAlgorithmException</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">sun.misc.BASE64Encoder</span><span style="color:#666">;</span>

<span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">DigestDemo</span> <span style="color:#666">{</span>
    <span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">static</span> <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">main</span><span style="color:#666">(</span>String<span style="color:#666">[</span><span style="color:#666">]</span> args<span style="color:#666">)</span> <span style="color:#a2f;font-weight:bold">throws</span> NoSuchAlgorithmException <span style="color:#666">{</span>
        String password <span style="color:#666">=</span> <span style="color:#b44">&#34;pass&#34;</span><span style="color:#666">;</span>
        String algorithm <span style="color:#666">=</span> <span style="color:#b44">&#34;SHA&#34;</span><span style="color:#666">;</span>
        
        <span style="color:#080;font-style:italic">// Calculate hash value
</span><span style="color:#080;font-style:italic"></span>        MessageDigest md <span style="color:#666">=</span> MessageDigest<span style="color:#666">.</span><span style="color:#b44">getInstance</span><span style="color:#666">(</span>algorithm<span style="color:#666">)</span><span style="color:#666">;</span>
        md<span style="color:#666">.</span><span style="color:#b44">update</span><span style="color:#666">(</span>password<span style="color:#666">.</span><span style="color:#b44">getBytes</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#0b0;font-weight:bold">byte</span><span style="color:#666">[</span><span style="color:#666">]</span> bytes <span style="color:#666">=</span> md<span style="color:#666">.</span><span style="color:#b44">digest</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        
        <span style="color:#080;font-style:italic">// Print out value in Base64 encoding
</span><span style="color:#080;font-style:italic"></span>        BASE64Encoder base64encoder <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> BASE64Encoder<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        String hash <span style="color:#666">=</span> base64encoder<span style="color:#666">.</span><span style="color:#b44">encode</span><span style="color:#666">(</span>bytes<span style="color:#666">)</span><span style="color:#666">;</span>        
        System<span style="color:#666">.</span><span style="color:#b44">out</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span><span style="color:#b44">&#39;{&#39;</span><span style="color:#666">+</span>algorithm<span style="color:#666">+</span><span style="color:#b44">&#39;}&#39;</span><span style="color:#666">+</span>hash<span style="color:#666">)</span><span style="color:#666">;</span>
    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>The output is &ldquo;{SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=&rdquo;.</p>
<p>Another option is to use command line tools to calculate the hash value; the <a href="http://www.openssl.org">OpenSSL</a> project provides such stuff. Furthermore many UI LDAP tools allow you to store passwords automatically encrypted with the hash algorithm of your choice. See below <a href="https://directory.apache.org/studio/">Apache Directory Studio</a> as an example. The dialog automatically shows up if a <em>userPassword</em> attribute is to be manipulated (added, changed).</p>
<p><img src="images/password-edit-ls.png" alt="Password Edit"></p>
<h3 id="from-an-ldap-client-point-of-view">From an LDAP client point of view</h3>
<p>From an LDAP client point of view, the behavior during authentication is the same as with passwords stored in clear. During a simple bind, a client sends DN and password (unencrypted, i.e. no hash algorithm applied) to the server. If ApacheDS detects, that the user password for the given DN is stored in the directory with a hash function applied, it calculates the hash value of the given password with the appropriate algorithm (this is why the algorithm is stored together with the hashed password). Afterwards it compares the result with the stored attribute value. In case of a match, the bind operation ends successfully:</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Horatio Hornblower,ou=people,o=sevenSeas&quot; \\ 
    -w pass -b &quot;ou=people,o=sevenSeas&quot; -s base &quot;(objectclass=*)&quot;
version: 1
dn: ou=people,o=sevenSeas
ou: people
description: Contains entries which describe persons (seamen)
objectclass: organizationalUnit
objectclass: top
</code></pre>
<p>Providing the hashed value of the <em>userPassword</em> attribute instead of the original value will be rejected by ApacheDS:</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -D &quot;cn=Horatio Hornblower,ou=people,o=sevenSeas&quot; \\
    -w &quot;{SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=&quot; -b &quot;ou=people,o=sevenSeas&quot; -s base &quot;(objectclass=*)&quot;
ldap_simple_bind: Invalid credentials
ldap_simple_bind: additional info: Bind failed: null
</code></pre>
<p>This is intended. If someone was able to catch this value (from an LDIF export for instance), s/he must still provide the password itself in order to get authenticated.</p>
<DIV class="note" markdown="1">
<b>Be Warned: Limited security added</b>
<p>Please note that storing user passwords one-way encrypted only adds limited security. During the bind operation, the credentials are still transmitted unencrypted, if no SSL/TLS communication is used (thus you should definitely consider to do so).</p>
<p>Furthermore, if someone gets an LDIF file with userpassword values digested with SHA etc., s/he may be able to determine some of the passwords with brute force. Calculation of hash functions can be done very fast, and the attacker can attempt millions of values with ease, without you getting notice of it. Therefore protect your data, even if one-way encryption is applied to the passwords!</p>
</DIV>
<h2 id="anonymous-binds">Anonymous binds</h2>
<p>In some occasions it is appropriate to allow LDAP clients to permit operations without authentication. If data managed by the directory service is well known by all clients, it is not uncommon to allow search operations (not manipulation) within this data to all clients &ndash; without providing credentials. An example for this are enterprise wide telephone books, if clients access the directory service from the intranet.</p>
<h3 id="enabledisable-anonymous-binds">Enable/disable anonymous binds</h3>
<p>Anonymous access is enabled by default. Changing this is one of the basic configuration tasks (see <a href="1.4.5-anonymous-access.html">1.4.5 - Enable and disable anonymous access</a>).</p>
<h3 id="example-server-behavior-with-anonymous-binds-disabled">Example: Server behavior with anonymous binds disabled</h3>
<p>Assume anonymous binds are disabled and our sample partition <em>Seven Seas</em> present in the server. Here is an example with a search operation performed by a command line tool as a client. It tries to connect anonymously (no DN and password given, i.e. options -D and -w missing) to the server. Afterwards the entry <em>ou=people,o=sevenSeas</em> should be displayed.</p>
<p>See the command and the resulting error message provided by the server below</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -b &quot;ou=people,o=sevenSeas&quot; -s one &quot;(objectclass=*)&quot;
ldap_search: Insufficient access
ldap_search: additional info: failed on search operation: Anonymous binds have been disabled!
</code></pre>
<h3 id="example-server-behavior-with-anonymous-binds-enabled">Example: Server behavior with anonymous binds enabled</h3>
<p>Now the same command performed against ApacheDS 1.5 with anonymous access enabled as described above. The behavior is different &ndash; the entry is visible.</p>
<pre><code>$ ldapsearch -h zanzibar -p 10389 -b &quot;ou=people,o=sevenSeas&quot; -s base &quot;(objectclass=*)&quot;
version: 1
dn: ou=people,o=sevenSeas
ou: people
description: Contains entries which describe persons (seamen)
objectclass: organizationalUnit
objectclass: top
</code></pre>
<h3 id="other-clients">Other clients</h3>
<p>The examples above have used a command line tool. Of course graphical tools and programmatical access (JNDI etc.) allow anonymous binds as well. Below is a screen shot from the configuration dialog of <a href="https://directory.apache.org/studio/">Apache Directory Studio</a> as an example. During configuration of the connection data (&ldquo;New LDAP Connection&rdquo;, for instance), the option <em>Anonymous Authentication</em> leads to anonymous binds. Other UI tools offer this feature as well.</p>
<p><img src="images/authentication-options-ls.png" alt="Authentication options"></p>
<DIV class="note" markdown="1">
**Use this feature wisely**
<p>With anonymous access enabled it is not only possible to search the directory without providing username and password. With autorization disabled, anonymous users may also be able to modify data. It is therefore highly recommended to enable and configure the authorization subsystem as well. Learn more about authorization in the [3.2. Basic authorization] section.</p>
</DIV>
<h2 id="how-to-authenticate-a-user-by-uid-and-password">How to authenticate a user by uid and password?</h2>
<p>If you want to use simple binds with user DN and password within a Java component, in order to authenticate users programatically, in practice one problem arises: Most users do not know their DN. Therefore they will not be able to enter it. And even if they know it, it would be frequently very laborious due to the length of the DN. It would be easier for a user if s/he only has to probvide a short, unique <em>ID</em> and the password, like in this web form</p>
<p><img src="images/confluence-logon.png" alt="Confluence Logon"></p>
<p>Usually the ID is an attribute within the user&rsquo;s entry. In our sample data (Seven Seas), each user entry contains the <em>uid</em> attribute, for instance uid=hhornblo for Captain Hornblower:</p>
<pre><code>dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
objectclass: top
cn: Horatio Hornblower
description: Capt. Horatio Hornblower, R.N
givenname: Horatio
sn: Hornblower
uid: hhornblo
mail: hhornblo@royalnavy.mod.uk
userpassword: {SHA}nU4eI71bcnBGqeO0t9tXvY1u5oQ=
</code></pre>
<p>But how to authenticate a user who provides &ldquo;hhornblo&rdquo;/&ldquo;pass&rdquo; instead of &ldquo;cn=Horatio Hornblower,ou=people,o=sevenSeas&rdquo;/&ldquo;pass&rdquo; with the help of ApacheDS?</p>
<h3 id="an-algorithm">An algorithm</h3>
<p>In order to accomplish this task programmatically, one option is to perform the following steps</p>
<h4 id="arguments">Arguments</h4>
<ul>
<li><em>uid</em> of a user (e.g. &ldquo;hhornblo&rdquo;)</li>
<li><em>password</em> proclaimed to be correct for the user</li>
</ul>
<h4 id="steps">Steps</h4>
<ul>
<li>Bind to ApacheDS anonymously, or with the DN of a technical user. In both cases it must be possible to search the directory afterwards (authorization has to be configured that way)</li>
<li>Perform a search operation with an appropriate filter to find the user entry for the given ID, in our case &ldquo;(&amp;(objectClass=inetorgperson)(uid=hhornblo))&rdquo;
<ul>
<li>If the search result is empty, the user does not exist &ndash; terminate</li>
<li>If the search result contains more than one entry, the given ID is not unique, this is likely a data error within your directory</li>
</ul>
</li>
<li>Bind to ApacheDS with the DN of the entry found in the previous search, and the <em>password</em> provided as argument
<ul>
<li>If the bind operation fails, the password is wrong, and the result is <em>false</em> (not authenticated)</li>
<li>If the bind is successful, authenticate the user</li>
</ul>
</li>
</ul>
<h3 id="sample-code-with-jndi">Sample code with JNDI</h3>
<p>The algorithm described above is implemented by many software solutions which are able to integrate LDAP directories. You will learn more about some of them and their configuration options within a later section of this guide.</p>
<p>For illustration purposes, here is a simple Java program which performs the steps with the help of JNDI. It uses anonymous bind for the first step, hence it must be enabled (replace with a technical user, if it better meets your requirements).</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">java.util.Hashtable</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.Context</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.NamingEnumeration</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.NamingException</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.directory.DirContext</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.directory.InitialDirContext</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.directory.SearchControls</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">javax.naming.directory.SearchResult</span><span style="color:#666">;</span>

<span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">AdvancedBindDemo</span> <span style="color:#666">{</span>
    
    <span style="color:#a2f;font-weight:bold">public</span> <span style="color:#a2f;font-weight:bold">static</span> <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">main</span><span style="color:#666">(</span>String<span style="color:#666">[</span><span style="color:#666">]</span> args<span style="color:#666">)</span> <span style="color:#a2f;font-weight:bold">throws</span> NamingException <span style="color:#666">{</span>
        
        <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span>args<span style="color:#666">.</span><span style="color:#b44">length</span> <span style="color:#666">&lt;</span> 2<span style="color:#666">)</span> <span style="color:#666">{</span>
            System<span style="color:#666">.</span><span style="color:#b44">err</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span><span style="color:#b44">&#34;Usage: java AdvancedBindDemo &lt;uid&gt; &lt;password&gt;&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
            System<span style="color:#666">.</span><span style="color:#b44">exit</span><span style="color:#666">(</span>1<span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span>
        
        Hashtable env <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> Hashtable<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">INITIAL_CONTEXT_FACTORY</span><span style="color:#666">,</span> <span style="color:#b44">&#34;com.sun.jndi.ldap.LdapCtxFactory&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">PROVIDER_URL</span><span style="color:#666">,</span> <span style="color:#b44">&#34;ldap://zanzibar:10389/&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
        env<span style="color:#666">.</span><span style="color:#b44">put</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">SECURITY_AUTHENTICATION</span><span style="color:#666">,</span> <span style="color:#b44">&#34;simple&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
        
        String uid <span style="color:#666">=</span> args<span style="color:#666">[</span>0<span style="color:#666">]</span><span style="color:#666">;</span>
        String password <span style="color:#666">=</span> args<span style="color:#666">[</span>1<span style="color:#666">]</span><span style="color:#666">;</span>
        
        DirContext ctx <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">null</span><span style="color:#666">;</span>
        
        <span style="color:#a2f;font-weight:bold">try</span> <span style="color:#666">{</span>            
            <span style="color:#080;font-style:italic">// Step 1: Bind anonymously            
</span><span style="color:#080;font-style:italic"></span>            ctx <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> InitialDirContext<span style="color:#666">(</span>env<span style="color:#666">)</span><span style="color:#666">;</span>
            
            <span style="color:#080;font-style:italic">// Step 2: Search the directory
</span><span style="color:#080;font-style:italic"></span>            String base <span style="color:#666">=</span> <span style="color:#b44">&#34;o=sevenSeas&#34;</span><span style="color:#666">;</span>
            String filter <span style="color:#666">=</span> <span style="color:#b44">&#34;(&amp;(objectClass=inetOrgPerson)(uid={0}))&#34;</span><span style="color:#666">;</span>           
            SearchControls ctls <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> SearchControls<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
            ctls<span style="color:#666">.</span><span style="color:#b44">setSearchScope</span><span style="color:#666">(</span>SearchControls<span style="color:#666">.</span><span style="color:#b44">SUBTREE_SCOPE</span><span style="color:#666">)</span><span style="color:#666">;</span>
            ctls<span style="color:#666">.</span><span style="color:#b44">setReturningAttributes</span><span style="color:#666">(</span><span style="color:#a2f;font-weight:bold">new</span> String<span style="color:#666">[</span>0<span style="color:#666">]</span><span style="color:#666">)</span><span style="color:#666">;</span>
            ctls<span style="color:#666">.</span><span style="color:#b44">setReturningObjFlag</span><span style="color:#666">(</span><span style="color:#a2f;font-weight:bold">true</span><span style="color:#666">)</span><span style="color:#666">;</span>
            NamingEnumeration enm <span style="color:#666">=</span> ctx<span style="color:#666">.</span><span style="color:#b44">search</span><span style="color:#666">(</span>base<span style="color:#666">,</span> filter<span style="color:#666">,</span> <span style="color:#a2f;font-weight:bold">new</span> String<span style="color:#666">[</span><span style="color:#666">]</span> <span style="color:#666">{</span> uid <span style="color:#666">}</span><span style="color:#666">,</span> ctls<span style="color:#666">)</span><span style="color:#666">;</span>
            
            String dn <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">null</span><span style="color:#666">;</span>
            
            <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span>enm<span style="color:#666">.</span><span style="color:#b44">hasMore</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span> <span style="color:#666">{</span>
                SearchResult result <span style="color:#666">=</span> <span style="color:#666">(</span>SearchResult<span style="color:#666">)</span> enm<span style="color:#666">.</span><span style="color:#b44">next</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
                dn <span style="color:#666">=</span> result<span style="color:#666">.</span><span style="color:#b44">getNameInNamespace</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
                
                System<span style="color:#666">.</span><span style="color:#b44">out</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span><span style="color:#b44">&#34;dn: &#34;</span><span style="color:#666">+</span>dn<span style="color:#666">)</span><span style="color:#666">;</span>
            <span style="color:#666">}</span>
            
            <span style="color:#a2f;font-weight:bold">if</span> <span style="color:#666">(</span>dn <span style="color:#666">=</span><span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">null</span> <span style="color:#666">|</span><span style="color:#666">|</span> enm<span style="color:#666">.</span><span style="color:#b44">hasMore</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span> <span style="color:#666">{</span>
                <span style="color:#080;font-style:italic">// uid not found or not unique
</span><span style="color:#080;font-style:italic"></span>                <span style="color:#a2f;font-weight:bold">throw</span> <span style="color:#a2f;font-weight:bold">new</span> NamingException<span style="color:#666">(</span><span style="color:#b44">&#34;Authentication failed&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
            <span style="color:#666">}</span>
            
            <span style="color:#080;font-style:italic">// Step 3: Bind with found DN and given password
</span><span style="color:#080;font-style:italic"></span>            ctx<span style="color:#666">.</span><span style="color:#b44">addToEnvironment</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">SECURITY_PRINCIPAL</span><span style="color:#666">,</span> dn<span style="color:#666">)</span><span style="color:#666">;</span>
            ctx<span style="color:#666">.</span><span style="color:#b44">addToEnvironment</span><span style="color:#666">(</span>Context<span style="color:#666">.</span><span style="color:#b44">SECURITY_CREDENTIALS</span><span style="color:#666">,</span> password<span style="color:#666">)</span><span style="color:#666">;</span>
            <span style="color:#080;font-style:italic">// Perform a lookup in order to force a bind operation with JNDI
</span><span style="color:#080;font-style:italic"></span>            ctx<span style="color:#666">.</span><span style="color:#b44">lookup</span><span style="color:#666">(</span>dn<span style="color:#666">)</span><span style="color:#666">;</span>
            System<span style="color:#666">.</span><span style="color:#b44">out</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span><span style="color:#b44">&#34;Authentication successful&#34;</span><span style="color:#666">)</span><span style="color:#666">;</span>
            
            enm<span style="color:#666">.</span><span style="color:#b44">close</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span> <span style="color:#a2f;font-weight:bold">catch</span> <span style="color:#666">(</span>NamingException e<span style="color:#666">)</span> <span style="color:#666">{</span>
            System<span style="color:#666">.</span><span style="color:#b44">out</span><span style="color:#666">.</span><span style="color:#b44">println</span><span style="color:#666">(</span>e<span style="color:#666">.</span><span style="color:#b44">getMessage</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span> <span style="color:#a2f;font-weight:bold">finally</span> <span style="color:#666">{</span>
            ctx<span style="color:#666">.</span><span style="color:#b44">close</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        <span style="color:#666">}</span>
    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div><p>Some example calls:</p>
<pre><code>$ java AdvancedBindDemo unknown sailor
Authentication failed

$ java AdvancedBindDemo hornblo pass
dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
Authentication successful

$ java AdvancedBindDemo hornblo quatsch
dn: cn=Horatio Hornblower,ou=people,o=sevenSeas
[LDAP: error code 49 - Bind failed: null]
</code></pre>
<p>The examples consist of an unknown user (an <em>inetOrgPerson</em> entry with uid=unknown does not exist), a successful authenttication, and an attempt with an existing uid but a wrong password.</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="http://www.faqs.org/rfcs/rfc2829.html">RFC 2829</a> Authentication Methods for LDAP</li>
<li><a href="http://www.secure-hash-algorithm-md5-sha-1.co.uk/">The Secure Hash Algorithm Directory</a> MD5, SHA-1 and HMAC Resources</li>
</ul>


            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="3-basic-security.html">3 - Basic Security</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="3-basic-security.html">3 - Basic Security</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="3.2-basic-authorization.html">3.2 - Basic authorization</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2020, <a href="http://www.apache.org">The Apache Software Foundation</a> - <a href="/privacy-policy.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
