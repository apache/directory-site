<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>3.2 Operations on an Administrative Point &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/green.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
    <script src="https://www.apachecon.com/event-images/snippet.js"></script>
</head>

<body>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
            
                <strong>ApacheDS</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <a class="acevent" data-format="wide" data-width="170"></a>
                <h5>ApacheDS 2.0</h5>
                <ul>
                    <li><a href="/apacheds/">Home</a></li>
                    <li><a href="/apacheds/news.html">News</a></li>
                    <li><a href="/apacheds/features.html">Features</a></li>
                    <li><a href="/apacheds/production-readiness.html">Production Readiness</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/apacheds/downloads.html">ApacheDS 2.0.0.AM27</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/apacheds/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/apacheds/basic-user-guide.html">Basic User Guide </a></li>
                    <li><a href="/apacheds/advanced-user-guide.html">Advanced User Guide</a></li>
                    <li><a href="/apacheds/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/apacheds/kerberos-user-guide.html">Kerberos User Guide</a></li>
                    <li><a href="/apacheds/configuration/ads-2.0-configuration.html">Configuration</a></li>
                    <li><a href="/apacheds/gen-docs/latest/apidocs">JavaDocs</a></li>
                    <li><a href="/apacheds/gen-docs/latest/xref">Cross-Reference</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="https://www.apache.org/">Apache</a></li>
    <li><a href="https://www.apache.org/licenses/">License</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="https://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="3.1-administrative-points.html">3.1 - Administrative Points</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="3-admin-model.html">Administrative Model</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="4-authentication-and-authorization.html">4 - Authentication and Authorization</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="32-operations-on-an-administrative-point">3.2 Operations on an Administrative Point</h1>
<p>There are six kind of operations we can have on an AdministrativePoint :</p>
<ul>
<li>creating a new AP</li>
<li>removing an existing AP</li>
<li>modifying an existing AP by adding or removing a role</li>
<li>renaming an AP</li>
<li>moving an AP</li>
<li>renaming or moving an AP</li>
</ul>
<p>Renaming an AP has no impact on the administrative model, as we don&rsquo;t point
(internally) on the entry&rsquo;s DN, but on its UUID, so the last three
operations can be gathered into one single Move operation.</p>
<p>Also note that any modification made on an entry&rsquo;s AdminsitrativeRole may
have an impact on all it&rsquo;s descendants and ascendants (this is true for the
Modify and Move operation)</p>
<h2 id="adding-an-ap-entry">Adding an AP entry</h2>
<p>This seems to be a simple operation, however many checks have to be done in
order to not break the existing Administrative model.</p>
<p>First of all, we have to check that the added entry contains the
AdministrativeRole attributeType, and that this role is not empty. As we
don&rsquo;t have any semantic control for this AT (the attached syntax is just
expecting the values to be Strings), we have to do those checks in the
AdminInterceptor.</p>
<p>Here are the checks we must provide :</p>
<ul>
<li>the AdministrativeRole AT must have values</li>
<li>those values must be roles (ie one of the 4 possible specific area roles,
or one of the 3 inner area roles, or the autonomous area role)</li>
<li>there should not be duplicated</li>
<li>we can&rsquo;t have an AAP with any other role</li>
<li>we can&rsquo;t have an IAP and an SAP for the same role</li>
</ul>
<p>Once those basic checks done, we also have to check that the roles
hierarchy will remain consistent after the addition, ie :</p>
<ul>
<li>if an IAP is added, it must have a parent AAP or at least a parent SAP
for the same role</li>
</ul>
<p>If all those checks are ok, we can add the entry into the base, and update
the AP cache</p>
<h2 id="deleting-an-ap-entry">Deleting an AP entry</h2>
<p>This operation is way simpler, as we can&rsquo;t delete an entry if it has some
children, so there is no need to check that the administrative model is
consistent.</p>
<p>We just have to remove the entry and update the AP cache</p>
<h2 id="modifying-an-ap-entry">Modifying an AP entry</h2>
<p>This is way more complex. We can have five kind of modification here :</p>
<ul>
<li>addition of roles</li>
<li>deletion of roles</li>
<li>replacement of roles</li>
<li>creation of a new AdministrativeRole attribute</li>
<li>removing of an existing AdministrativeRole attribute</li>
</ul>
<p>The three first modifications can imply more than one role. We have to deal
with each of those modifications one by one.</p>
<h3 id="addition-of-roles">Addition of roles</h3>
<p>For this modification, we will have to check for each of the roles the very
same elements than for the Add operation above :</p>
<ul>
<li>if the entry does not have an AdministrativeRole AT, we have to create it</li>
<li>we must have at least one value</li>
<li>the role must be syntaxicaly correct</li>
<li>it should not already exist into the attribute</li>
<li>we can&rsquo;t add it if we already have an AAP role</li>
<li>we can&rsquo;t add it if it&rsquo;s an IAP and a SAP with the same role exists</li>
<li>if it&rsquo;s an IAP, it must have a parent AAP or SAP with the same role</li>
</ul>
<p>If all of those checks are ok, we can update the AP cache, which must be
cloned, otherwise we may have to rollback the operation if any of the
following modification fails.</p>
<h3 id="removing-of-roles">Removing of roles</h3>
<p>First, if there is no value for this modification, then that means we must
delete the Attribute. This case will be analyzed later.
For each of the roles to remove, we have to apply those checks :</p>
<ul>
<li>the role must be syntaxicaly correct</li>
<li>it must already exist into the attribute</li>
<li>we can&rsquo;t remove an AAP or a SAP if there is a direct IAP in one of its
direct descendant (ie, if we have a SAP or an AAP while descending into the
tree, we can stop checking the branch)</li>
</ul>
<p>Now, if there are no values, we have to get the existing roles and apply he
same checks</p>
<p>If everything is fine, we can remove the roles from the attribute.</p>
<h3 id="replacing-roles">Replacing roles</h3>
<p>This kind of modifications are not currently supported</p>
<h2 id="moving-an-ap">Moving an AP</h2>
<p>As we move the entry, we may induce some inconsistencies in the AP tree.</p>
<p>The problem we might have is that if we move an entry having an IAP in a
place where this role has no parent AAP or parent SAP with the same role,
then the AdministrativeModel tree will be inconsistent. We have to check
this.</p>
<h1 id="impact-on-the-existing-entries">Impact on the existing entries</h1>
<p>When we add or remove a role in a server, it may have a huge impact on the
existing entries, as soon as those roles are associated with some
subtreeSpecification which defines a set of contained entries. If we remove
such a role, all the entries pertaining to the associated area have to be
updated.</p>
<p>It&rsquo;s the same thing if we add a SAP or a AAP, as all the children entries
which were depending on a higher AP will be modified either.</p>
<p>In any case, we don&rsquo;t even need to define a SubtreeSpecification, as soon
as an AAP or SAP is created, it excludes all the children entries from any
other higher AP areas.</p>
<h2 id="adding-a-role">Adding a Role</h2>
<p>Whatever the way we used to add a role (add an entry, modify an existing
one), there are one thing we have to do depending on the kind of role we
added. Of course, we stop modifying entries when another lower SAP or AAP
is defined.</p>
<h3 id="adding-an-aap">Adding an AAP</h3>
<p>All the children which were pointing to any higher IAP, SAP or AAP will be
dereferenced. If a subtree specification is added under the newly added
AAP, then all the associated entries will be updated.</p>
<h3 id="adding-a-sap">Adding a SAP</h3>
<p>All the children which were pointing to any higher IAP or SAP with the same
type of role, or an AAP, will be dereferenced (of course, only for the
added type of role, the other references will remain). If a subtree
specification is added under the newly added SAP, then all the associated
entries will be updated.</p>
<h3 id="adding-an-iap">Adding an IAP</h3>
<p>All the children which were pointing to any higher IAP with the same type
of role will be dereferenced, and will now point to this newly added IAP.
All the children which were pointing on a SAP with the same role, or an
AAP, will be modified to also point on the newly added IAP.</p>
<h2 id="removing-a-role">Removing a role</h2>
<p>Depending on the kind of role we removed, we will have to update the
entries accordingly.</p>
<h3 id="removing-an-aap">Removing an AAP</h3>
<p>All the entries referencing the removed AAP will be updated, and will now
reference the inherited AAP, SAP and IAP (if any). If there is some higher
IAP, we will also reference it.</p>
<h3 id="removing-a-sap">Removing a SAP</h3>
<p>All the entries referencing the removed SAP will be updated, and will now
reference either the parent AAP or the parent SAP with the same role, if
any. We will also reference an IAP with the same role if we have some
higher in the hierarchy.</p>
<h3 id="removing-an-iap">Removing an IAP</h3>
<p>All the entries referencing the removed IAP will be updated. There is
nothing else to do.</p>


            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="3.1-administrative-points.html">3.1 - Administrative Points</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="3-admin-model.html">Administrative Model</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="4-authentication-and-authorization.html">4 - Authentication and Authorization</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2024, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
