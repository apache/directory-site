<!DOCTYPE html>

<html lang="en">
<script src="https://www.apachecon.com/event-images/snippet.js"></script>
<head>
    <meta charset="utf-8">
    <title>4.1.1.2 Name/Password Authentication &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/green.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
</head>

<body>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
            
                <strong>ApacheDS</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <a class="acevent" data-format="wide"></a>
                <h5>ApacheDS 2.0</h5>
                <ul>
                    <li><a href="/apacheds/">Home</a></li>
                    <li><a href="/apacheds/news.html">News</a></li>
                    <li><a href="/apacheds/features.html">Features</a></li>
                    <li><a href="/apacheds/production-readiness.html">Production Readiness</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/apacheds/downloads.html">ApacheDS 2.0.0.AM26</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/apacheds/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/apacheds/basic-user-guide.html">Basic User Guide </a></li>
                    <li><a href="/apacheds/advanced-user-guide.html">Advanced User Guide</a></li>
                    <li><a href="/apacheds/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/apacheds/kerberos-user-guide.html">Kerberos User Guide</a></li>
                    <li><a href="/apacheds/configuration/ads-2.0-configuration.html">Configuration</a></li>
                    <li><a href="/apacheds/gen-docs/latest/apidocs">JavaDocs</a></li>
                    <li><a href="/apacheds/gen-docs/latest/xref">Cross-Reference</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="https://www.apache.org/">Apache</a></li>
    <li><a href="https://www.apache.org/licenses/">License</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="https://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="4.1.1.1-anonymous-authn.html">4.1.1.1 Anonymous Authentication</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="4.1.1-simple-authn.html">4.1.1 - Simple Authentication</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="4.1.1.3-unauthenticated-authn.html">4.1.1.3 - Unauthenticated Authentication</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="4112---namepassword-authentication">4.1.1.2 - Name/Password Authentication</h1>
<p>This is the most common authentication system, though not the safest. The user provides his name and a password. Both are passed as clear text to the server, which checks that the user exists, and that its password is correct.</p>
<h2 id="users-name-retrieval">User&rsquo;s name retrieval</h2>
<p>The first thing the server does is to check that the user&rsquo;s name exists in the server. The provided name is always a full <strong>DN</strong>.</p>
<p>Here is an example of simple authentication using Studio, where we authenticate the <strong>uid=admin,ou=system</strong> user :</p>
<p><img src="images/simple-name-password-authn.png" alt="Name/Password authentication"></p>
<p>The password is not visible here, but this is just for security reasons.</p>
<p>This request is sent to the server, which will check that the <strong>uid=admin,ou=system</strong> exists in its backend. If it doesn&rsquo;t, the authentication will fail.</p>
<h2 id="password-check">Password check</h2>
<p>That&rsquo;s not enough : once the user is retrieved, we have to check the provided password against the stored password.</p>
<p>The entry associated with the user should contain a <strong>userPassword</strong> AttributeType, otherwise the request will be rejected. Here is an example of such an entry :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">version: 1

dn: uid=admin,ou=system
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
cn: system administrator
sn: administrator
displayName: Directory Superuser
uid: admin
userPassword:: c2VjcmV0
</code></pre></div><p>As we can see, this entry has an <strong>userPassword</strong> which contains the base64 encoded password. If we decode the value, we get :</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">userPassword: secret
</code></pre></div><p>Not exactly safe&hellip;</p>
<h3 id="password-storage">Password storage</h3>
<p>As we have just seen, the password is stored in plain text in the server. This is not exactly safe ! As soon as someone gets access to your server, all the passwords are compromised. This is certainly not the way we want to protect our users !</p>
<p>Hopefully, you can hash those passwords, instead of storing them as provided.</p>
<DIV class="note" markdown="1">
A hashed password is not a password we can decrypt : when we hash a password, we lose some information. Also note that two different passwords might result in the exact same hash value, but it's unlikely.
</DIV>
<p><strong>ApacheDS</strong> let you select an encryption type when you inject a password :</p>
<p><img src="images/password-hash-selection.png" alt="Password hash method selection"></p>
<p>The following hash method are available :</p>
<table>
<thead>
<tr>
<th>Hash method</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>PLAIN</td>
<td>no hashing</td>
</tr>
<tr>
<td>MD5</td>
<td>-</td>
</tr>
<tr>
<td>SMD5</td>
<td>Salted MD5</td>
</tr>
<tr>
<td>crypt</td>
<td>-</td>
</tr>
<tr>
<td>SHA</td>
<td>SHA-1</td>
</tr>
<tr>
<td>SSHA</td>
<td>Salted SHA-1</td>
</tr>
<tr>
<td>SHA-256</td>
<td>SHA-2 (Studio 2.0)</td>
</tr>
<tr>
<td>SSHA-256</td>
<td>Salted SHA-2 (Studio 2.0)</td>
</tr>
<tr>
<td>SHA-384</td>
<td>SHA-2 (Studio 2.0)</td>
</tr>
<tr>
<td>SSHA-384</td>
<td>Salted SHA-2 (Studio 2.0)</td>
</tr>
<tr>
<td>SHA-512</td>
<td>SHA-2 (Studio 2.0)</td>
</tr>
<tr>
<td>SSHA-512</td>
<td>Salted SHA-2 (Studio 2.0)</td>
</tr>
</tbody>
</table>
<h3 id="how-it-works-">How it works ?</h3>
<p>So the server receives a Name/Password authentication request. The password is <em>in clear text</em> up to this point. Once the user is found in the server, and if it has a <strong>userPassword</strong> attributeType, the server extracts each values contained in this AttributeType (we may have more than one password per user) and check the provided password against those values.</p>
<p>This is not as simple as it seems : as we may have hashed the values on the server, we first have to detect the selected hash method, and then hash the provided password, which result is compared to the stored hashed value.</p>
<p>Hopefully, the hash method is stored within the hashed password in the server :</p>
<pre><code>version: 1

dn: uid=admin,ou=system
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
cn: system administrator
sn: administrator
displayName: Directory Superuser
uid: admin
userPassword:: c2VjcmV0
userPassword:: {CRYPT}FgGgCMynLfYGw
</code></pre>
<p>Here, one of the <strong>userPassword</strong> value is hashed using the <strong>crypt</strong> algorithm. The following code is used to check the provided password :</p>
<pre><code>for each stored password
  if it has a hash method 
    then 
      extract the method
      hash the provided password using this method
      compare the result with the stored hash value
      if they are equal
        then
          return true
    else
      compare the provided password with the stored password
      if they are equal
        then
          return true
done

return false
</code></pre>
<DIV class="note" markdown="1">
  A few rules of thumb :<BR/>
  o Never store a password as plain text. <BR/>
  o Prefer salted methods over non salted ones, and prefer the strongest one (here, SSHA-512 on Studio 2.0, or SSHA)<BR/>
  o crypt is also a good choice<BR/>
  o Pick strong passwords, otherwise if someone gets access to the list of passwords, he or she can run a rainbow attack on it.<BR/>
  o Keep in mind that whatever you do, the password will be passed in clear text from the client to the server. Always use startTLS before any bind, or at least use SSL<BR/>
</DIV>

            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="4.1.1.1-anonymous-authn.html">4.1.1.1 Anonymous Authentication</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="4.1.1-simple-authn.html">4.1.1 - Simple Authentication</a>
            
        </div>
        <div class="nav_next">
            
                
                <a href="4.1.1.3-unauthenticated-authn.html">4.1.1.3 - Unauthenticated Authentication</a>
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2023, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
