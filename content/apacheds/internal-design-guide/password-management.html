<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Apache DS - Password Management &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/green.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
    <script src="https://www.apachecon.com/event-images/snippet.js"></script>
</head>

<body>
<div id="container">
    <div id="header">
    <a href="/"><div id="headerClick"></div></a>
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
            
                <strong>ApacheDS</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <a class="acevent" data-format="wide" data-width="170"></a>
                <h5>ApacheDS 2.0</h5>
                <ul>
                    <li><a href="/apacheds/">Home</a></li>
                    <li><a href="/apacheds/news.html">News</a></li>
                    <li><a href="/apacheds/features.html">Features</a></li>
                    <li><a href="/apacheds/production-readiness.html">Production Readiness</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/apacheds/downloads.html">ApacheDS 2.0.0.AM27</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/apacheds/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/apacheds/basic-user-guide.html">Basic User Guide </a></li>
                    <li><a href="/apacheds/advanced-user-guide.html">Advanced User Guide</a></li>
                    <li><a href="/apacheds/developer-guide.html">Developer Guide</a></li>
                    <li><a href="/apacheds/kerberos-user-guide.html">Kerberos User Guide</a></li>
                    <li><a href="/apacheds/configuration/ads-2.0-configuration.html">Configuration</a></li>
                    <li><a href="/apacheds/gen-docs/latest/apidocs">JavaDocs</a></li>
                    <li><a href="/apacheds/gen-docs/latest/xref">Cross-Reference</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="https://www.apache.org/">Apache</a></li>
    <li><a href="https://www.apache.org/licenses/">License</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="https://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            

            
	<h1 id="password-management">Password Management</h1>
<p>There are four places where passwords are manipulated in ApacheDS:</p>
<ul>
<li><strong>authn</strong> interceptor</li>
<li><strong>hash</strong> interceptor</li>
<li><strong>PasswordPolicy</strong></li>
<li><strong>PasswordModify</strong> extended operation</li>
</ul>
<p>It&rsquo;s all about having those four piece of code to work well together, considering the requirements are different, somehow.</p>
<h2 id="default-password-storage">Default password storage</h2>
<p>The password we use to authenticate a user when using a <em>SimpleBind</em> request is <em>userPassword</em>. Ther eis no requirement that it is the attribute to use, per <a href="https://tools.ietf.org/html/rfc4513#appendix-B.2.5">RFC 4513, appendix B.2.5</a> though :</p>
<pre><code>::: text
Removed the implication that the userPassword attribute is the sole
location for storage of password values to be used in
authentication.  There is no longer any implied requirement for how
or where passwords are stored at the server for use in
authentication.
</code></pre>
<p>This was like that for historical reasons, especially <a href="https://tools.ietf.org/html/rfc2829#section-6.2">RFC 2829, section 6.2</a> :</p>
<pre><code>::: text
The server will, for each value of the userPassword attribute in the
named user's entry, compare these for case-sensitive equality with
the client's presented password.  If there is a match, then the
server will respond with resultCode success, otherwise the server
will respond with resultCode invalidCredentials.
</code></pre>
<p>So we keep going with <em>userPassword</em>.</p>
<p>Up to a point, changing that is not really a big deal: it&rsquo;s all about adding a new <em>Authenticator</em> that does not check against the <em>userPassword</em> attribute.</p>
<h2 id="authentication-with-password">Authentication with password</h2>
<p>We aren&rsquo;t going to talk about other authentication mechanisms here (Anonymous, <strong>SASL</strong>, etc).</p>
<p>So the server receives a <em>BindRequest</em> which contains the <strong>DN</strong> of a user that is expected to have a <em>userPassword</em> attribute with the same value that the one contained in the request. The deal is to check that this user exists, and has the proper password. The algorithm is pretty simple :</p>
<pre><code>::: text
receive a BindReques with a DN and a password
check if the DN user exists
if not
  generate an error
check that the user has a userPassword attribute
if not
  generate an error
for each value in this attribite
  check if it macthes with the provided password
  if so
    return success
if we haven't matched any password
  generate an error
</code></pre>
<p>This is pretty straightforward, except that we may have more than one store password, because the <em>userPassword</em> attributeType is multi-valued.</p>
<p>We have one more complication : we can store hashed passwords (actually, this <em>should</em> be the default). In thsi case, the hashed password is prefixed by the algorithm used to hash the password :</p>
<pre><code>::: text
{SHA512}XXXXXXXXXX...
</code></pre>
<p>So for each stored password, we first extract the algorithm, and use it to hash the provided password, and compare it with the stored hashed password.</p>
<p>This is implemented through the use of <em>Authenticator</em> instances. There are 4 flavors of authenticators :</p>
<ul>
<li><em>AnonymousAuthenticator</em> : basically does nothing but create a <em>LdapSession</em> if anonymous binds are allowed.</li>
<li><em>SimpleAuthenticator</em> : checks that the bind DN and password fits, following the previously shown algorithm.</li>
<li><em>StrongAuthenticator</em> : Only used when a SASL authentication has been done. It just creates the <em>LDapSession</em></li>
<li><em>DelegatedAuthenticator</em> : Delegate authentication to a remote <strong>LDAP</strong> server. Nothing fancy, it just does a <em>SimpleBind</em>.</li>
</ul>
<p>In any case, the verification is done by the <em>authenticate()</em> method.</p>
<p>Side note: We have a cache to speedup the authentication, and we also check the <em>PasswordPolicy</em> if there is one that can be applied.</p>
<h2 id="bind-request-processing">Bind Request processing</h2>
<p>When a <em>BindRequest</em> is received by the server, it&rsquo;s handled by the <em>BindRequestHandler</em> class, and in our case, its <em>handleSimpleAuth()</em> method is called. We create a <em>BindOperationContext</em> instance which contains all that is necessary during the <strong>Bind</strong> process. This context contains various informations :</p>
<ul>
<li>the <em>principal</em> (ie the entry associated with the provided <strong>DN</strong>)</li>
<li>the credentials (aka provided password), as a byte array</li>
<li>the <em>IoSession</em> instance (because we need to get some information related to the connection)</li>
<li>plus some SASL information that are not useful here</li>
</ul>
<p>Regardless of some subtilities (like dealing with referrals), we first load the target entry (it it exists !), then we call the interceptor chain with the created context. The <strong>BIND</strong> operation is processed by the two following interceptors :</p>
<ul>
<li><em>AuthenticationInterceptor</em> : manage the authentication</li>
<li><em>TimerInterceptor</em> : compute the time it takes to process an operation (not active unless requested)</li>
</ul>
<p>So all the work is done in the <em>AuthenticationInterceptor</em> class. It selects the <em>authenticator</em> instance to use, and calls the <em>authenticate()</em> method.</p>
<p>TBC</p>
<h1 id="passwordmodify-extended-operation">PasswordModify extended operation</h1>
<p>When it comes to modify a password, one way to do it is to use the <strong>Modify</strong> operation, or to use the <a href="https://tools.ietf.org/html/rfc3062">PasswordModify</a> extended operation. The second extends the semantic of the <strong>Modify</strong> operation, which must be applied to an entry. Typically, the <em>userIdentity</em> that is used to describe the user which password must be changed can be a <strong>DN</strong>, or something else. It&rsquo;s up to the server to find out what this identify resolves to. For the same reason, the password isn&rsquo;t expected to be stored in a specific attribute, again it&rsquo;s up to the implemented to decide which filed has to store this password (assuming this information has to be stored in teh <strong>DIT</strong>, which is not mandated by the RFC&hellip;)</p>
<p>regarding <strong>ApacheDS</strong>, however, we currently expect the user identity to be the <strong>DN</strong> of an existing entry withing the <strong>DIT</strong>, and the modified password is <em>userPassword</em>. In some ways, it&rsquo;s pretty much a dedicated <strong>Modify</strong> operation, where you don&rsquo;t have to care about the attribute or the logic. All in all, it will do one of the following operations:</p>
<ul>
<li>If the identity is not provided, then the current user&rsquo;s password will be modified</li>
<li>Otherwise, assuming the current user has the right to modify another entry&rsquo;s password, this will apply the modification to the identified entry</li>
<li>If the old password is provided, the first thing the operation will do is to check that this password is valid, ie it can be used to bind the user subject to this password modification</li>
<li>If the new password is not provided,  <strong>ApacheDS</strong> will <strong>NOT</strong> generate a password - the RFC suggest the implements <strong>SHALL</strong> generate a new password, or generate an error, we have chosen the second option</li>
<li>If the new password is provided, it will replace the old password if provided, or will replace all the existing values of the <em>userPassword</em> attribute (which can be multi-valued).</li>
</ul>
<h1 id="passwordpolicy-management">PasswordPolicy management</h1>
<p>The <em>PasswordPolicy</em> is activated when we have an active subtree defining it (there is a default configuration, but one can set as many configuration as wanted). At the moment, such a configuration is either defined in the main configuration file, or as a subtree.</p>
<p>We use a <em>PpolicyConfigContainer</em> instance to store all the existing <em>PasswordPolicy</em> configuration. A call to the addPolicy( Dn, PasswordPolicyConfiguration )_ method will store those configuration in a _Map_.</p>
<p>The initialization of the default configuration is done in the <em>ServiceBuilder.createInterceptors()</em> method, while processing the <em>AuthenticationInterceptorBean</em> component.</p>
<h2 id="execution">Execution</h2>
<p>When a <strong>Bind</strong> operation occurs, the server will check the PasswordPolicy rules. This is done in the <em>SimpleAuthenticator.authenticate()</em> method (note that we don&rsquo;t enforce the password policy for any other authentication mchanism : )</p>


            

        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2025, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
