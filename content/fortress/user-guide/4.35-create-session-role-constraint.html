<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>4.35 - Create Session Role Constraint &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/turquoise.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
    <script src="https://www.apachecon.com/event-images/snippet.js"></script>
</head>

<body>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
             
                ApacheDS
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
             
                Mavibot
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
            
                <strong>Fortress</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <a class="acevent" data-format="wide" data-width="170"></a>
                <h5>Fortress</h5>
                <ul>
                    <li><a href="/fortress/">Home</a></li>
                    <li><a href="/fortress/history.html">History</a></li>
                    <li><a href="/fortress/news.html">News</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/fortress/downloads.html">Fortress 3.0.0</a>&nbsp;&nbsp;<img src="/images/new_badge.gif" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/fortress/download-old-versions.html">Older versions</a></li>
                </ul>

                

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/fortress/overview.html">Overview</a></li>
                    <li><a href="/fortress/installation.html">Installation Guide</a></li>
                    <li><a href="/fortress/gen-docs/latest/apidocs/">JavaDocs</a></li>
                    <li><a href="/fortress/user-guide.html">Users Guide</a></li>
                    <li><a href="/fortress/user-guide-advanced.html">Advanced Users Guide</a></li>
                    <li><a href="/fortress/coding-standards.html">Coding Standards</a></li>
                    <li><a href="/fortress/testimonials.html">Testimonials</a></li>
                    <li><a href="/fortress/developer-guide.html">Developer Guide</a></li>
                    
                    
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="https://www.apache.org/">Apache</a></li>
    <li><a href="https://www.apache.org/licenses/">License</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="https://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="4.34-remove-role-constraint.html">4.34 - Remove Role Constraint</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="4-fortress-code-samples.html">4 - Fortress Code Samples</a>
            
        </div>
        <div class="nav_next">
            
                &nbsp;
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="435---create-session-role-constraint">4.35 - Create Session Role Constraint</h1>
<h2 id="an-example-of-combining-limited-abac-capability-with-standard-rbac">An example of combining limited ABAC capability with standard RBAC.</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Session <span style="color:#00a000">createSession</span><span style="color:#666">(</span> User user<span style="color:#666">,</span> List<span style="color:#666">&lt;</span>RoleConstraint<span style="color:#666">&gt;</span> constraints<span style="color:#666">,</span> <span style="color:#0b0;font-weight:bold">boolean</span> isTrusted <span style="color:#666">)</span> <span style="color:#a2f;font-weight:bold">throws</span> SecurityException
</code></pre></div><p>Perform user authentication and role activations in one method plus additional attribute constraints for evaluation.
This method must be called once per user prior to calling other methods within this class. The successful result is Session that contains target user&rsquo;s RBAC roles.
In addition to checking user password validity it will apply configured password policy checks.</p>
<p>Parameters:</p>
<ul>
<li>user - Contains User.userId, User.password (optional if isTrusted is &lsquo;true&rsquo;), optional User.roles, optional User.adminRoles</li>
<li>constraints - list of key-value pairs bound for role activation checks.</li>
<li>isTrusted - For Single-sign-on scenarios. if true, password is not required.</li>
</ul>
<p>Returns:</p>
<ul>
<li>Session object will contain:
<ul>
<li>authentication result code Session.errorId</li>
<li>RBAC role activations Session.getRoles()</li>
<li>Admin Role activations Session.getAdminRoles()</li>
<li>Password policy codes Session.warnings, Session.expirationSeconds, Session.graceLogins</li>
<li>User entity information Session.getUser()</li>
</ul>
</li>
</ul>
<p>Throws:</p>
<ul>
<li>SecurityException - in the event of data validation failure, security policy violation or DAO error.</li>
</ul>
<h2 id="createsession-constrained">createSession (constrained)</h2>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.apache.directory.fortress.core.AccessMgr</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.apache.directory.fortress.core.AccessMgrFactory</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.apache.directory.fortress.core.SecurityException</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.apache.directory.fortress.core.model.Session</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.apache.directory.fortress.core.model.User</span><span style="color:#666">;</span>
<span style="color:#a2f;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">org.apache.directory.fortress.core.model.RoleConstraint</span><span style="color:#666">;</span>

<span style="color:#a2f">@test</span>
<span style="color:#a2f;font-weight:bold">public</span> <span style="color:#0b0;font-weight:bold">void</span> <span style="color:#00a000">createSessionConstrainedTest</span><span style="color:#666">(</span>String userId<span style="color:#666">,</span> String password<span style="color:#666">,</span> String key<span style="color:#666">,</span> String value<span style="color:#666">)</span>
<span style="color:#666">{</span>
    String szLocation <span style="color:#666">=</span> <span style="color:#b44">&#34;.createSessionConstrainedTest&#34;</span><span style="color:#666">;</span>
    <span style="color:#a2f;font-weight:bold">try</span>
    <span style="color:#666">{</span>
        <span style="color:#080;font-style:italic">// Instantiate the AccessMgr implementation which perform runtime operations.
</span><span style="color:#080;font-style:italic"></span>        AccessMgr accessMgr <span style="color:#666">=</span> AccessMgrFactory<span style="color:#666">.</span><span style="color:#b44">createInstance</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// The User entity is used to pass data into the createSession API.
</span><span style="color:#080;font-style:italic"></span>        User user <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> User<span style="color:#666">(</span>userId<span style="color:#666">,</span> password<span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// dynamic constraint pushed into the runtime context of fortress:
</span><span style="color:#080;font-style:italic"></span>        List<span style="color:#666">&lt;</span>RoleConstraint<span style="color:#666">&gt;</span> constraints <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> ArrayList<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        RoleConstraint constraint <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> RoleConstraint<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
        constraint<span style="color:#666">.</span><span style="color:#b44">setKey</span><span style="color:#666">(</span> key <span style="color:#666">)</span><span style="color:#666">;</span>
        constraint<span style="color:#666">.</span><span style="color:#b44">setValue</span><span style="color:#666">(</span> value <span style="color:#666">)</span><span style="color:#666">;</span>
        constraints<span style="color:#666">.</span><span style="color:#b44">add</span><span style="color:#666">(</span> constraint <span style="color:#666">)</span><span style="color:#666">;</span>
        
        <span style="color:#080;font-style:italic">// This API will return a Session object that contains the User&#39;s activated Roles and other info.
</span><span style="color:#080;font-style:italic"></span>        <span style="color:#080;font-style:italic">// One or more of these roles are validated by runtime attributes (role constraints).
</span><span style="color:#080;font-style:italic"></span>        Session session <span style="color:#666">=</span> accessMgr<span style="color:#666">.</span><span style="color:#b44">createSession</span><span style="color:#666">(</span> user<span style="color:#666">,</span> constraints<span style="color:#666">,</span> <span style="color:#a2f;font-weight:bold">false</span> <span style="color:#666">)</span><span style="color:#666">;</span>
    <span style="color:#666">}</span>
    <span style="color:#a2f;font-weight:bold">catch</span> <span style="color:#666">(</span>SecurityException ex<span style="color:#666">)</span>
    <span style="color:#666">{</span>
        LOG<span style="color:#666">.</span><span style="color:#b44">error</span><span style="color:#666">(</span>szLocation <span style="color:#666">+</span> <span style="color:#b44">&#34; userId [&#34;</span> <span style="color:#666">+</span> userId <span style="color:#666">+</span> <span style="color:#b44">&#34;]  caught SecurityException rc=&#34;</span> <span style="color:#666">+</span> ex<span style="color:#666">.</span><span style="color:#b44">getErrorId</span><span style="color:#666">(</span><span style="color:#666">)</span> <span style="color:#666">+</span> <span style="color:#b44">&#34;, msg=&#34;</span> <span style="color:#666">+</span> ex<span style="color:#666">.</span><span style="color:#b44">getMessage</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">,</span> ex<span style="color:#666">)</span><span style="color:#666">;</span>
        fail<span style="color:#666">(</span>ex<span style="color:#666">.</span><span style="color:#b44">getMessage</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>
    <span style="color:#666">}</span>
<span style="color:#666">}</span>
</code></pre></div>

            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="4.34-remove-role-constraint.html">4.34 - Remove Role Constraint</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="4-fortress-code-samples.html">4 - Fortress Code Samples</a>
            
        </div>
        <div class="nav_next">
            
                &nbsp;
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2023, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple,Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>

</div>

</body>

</html>
