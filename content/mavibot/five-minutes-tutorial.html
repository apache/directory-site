<!DOCTYPE html>

<html lang="en">


    
    
        
    

<head>
    <meta charset="utf-8">
    <title>Five Minutes Tutorial &mdash; Apache Directory</title>

    <link href="/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/css/mavibot.css" rel="stylesheet" type="text/css"/>

    <link rel="shortcut icon" href="/images/server-icon_16x16.png" />
    <script src="https://www.apachecon.com/event-images/snippet.js"></script>
</head>

<body>
<div class="top-bottom-spacer"></div>
<div id="container">
    <div id="header">
    <span>Apache Directory</span>
    <a href="/"><div id="headerClick"></div></a>
    <div id="subProjectsNavBar">
        <a href="/">
             
                Main
            
        </a>
        &nbsp;|&nbsp;
        <a href="/apacheds/">
             
                ApacheDS
            
        </a>
        &nbsp;|&nbsp;
        <a href="/studio/">
             
                Studio
            
        </a>
        &nbsp;|&nbsp;
        <a href="/api/">
             
                LDAP API
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mavibot/">
            
                <strong>Mavibot</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/scimple/">
             
                SCIMple
            
        </a>
        &nbsp;|&nbsp;
        <a href="/fortress/">
             
                Fortress
            
        </a>
        &nbsp;|&nbsp;
        <a href="/kerby/">
             
                Kerby
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                
                <a class="acevent" data-format="wide" data-width="170"></a>
                <h5>Mavibot 1.0</h5>
                <ul>
                    <li><a href="/mavibot/">Home</a></li>
                    <li><a href="/mavibot/news.html">News</a></li>
                </ul>

                <h5>Downloads</h5>
                <ul>
                    <li><a href="/mavibot/downloads.html">Version 1.0.0-M8</a>&nbsp;&nbsp;<img src="/images/new_badge.svg" alt="" style="margin-bottom:-3px;" border="0"></li>
                    <li><a href="/mavibot/download-old-versions.html">Older versions</a></li>
                </ul>

                <h5>Getting Started</h5>
                <ul>
                    <li><a href="/mavibot/vision.html">Vision</a></li>
                </ul>

                <h5>Documentation</h5>
                <ul>
                    <li><a href="/mavibot/five-minutes-tutorial.html">Five minutes tutorial</a></li>
                    <li><a href="/mavibot/user-guide.html">User Guide</a></li>
                    <li><a href="/mavibot/gen-docs/latest/apidocs/">JavaDocs</a></li>
                    <li><a href="/mavibot/gen-docs/latest/xref/">Cross-Reference</a></li>
                    
                    <li><a href="/mavibot/developer-guide.html">Developer Guide</a></li>
                </ul>

                <h5>Support</h5>
<ul>
    <li><a href="/mailing-lists-and-irc.html">Mailing Lists &amp; IRC</a></li>
    <li><a href="/sources.html">Sources</a></li>
    <li><a href="/issue-tracking.html">Issue Tracking</a></li>
    <li><a href="/commercial-support.html">Commercial Support</a></li>
</ul>

<h5>Community</h5>
<ul>
    <li><a href="/contribute.html">How to Contribute</a></li>
    <li><a href="/team.html">Team</a></li>
    <li><a href="/original-project-proposal.html">Original Project Proposal</a></li>
    <li><a href="/special-thanks.html" class="external-link" rel="nofollow">Special Thanks</a></li>
</ul>

<h5>About Apache</h5>
<ul>
    <li><a href="https://www.apache.org/">Apache</a></li>
    <li><a href="https://www.apache.org/licenses/">License</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
    <li><a href="https://www.apache.org/security/">Security</a></li>
</ul>

            </div>
        </div>
        <div id="rightColumn">
            

            
	<h1 id="five-minutes-tutorial">Five Minutes Tutorial</h1>
<p>Let&rsquo;s drop a quick sample first :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#080;font-style:italic">// Create a BTree that stores String indexed by a Long</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>BTree<span style="color:#666">&lt;</span>Long,<span style="color:#bbb"> </span>String<span style="color:#666">&gt;</span><span style="color:#bbb"> </span>btree<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>BTree<span style="color:#666">&lt;</span>Long,<span style="color:#bbb"> </span>String<span style="color:#666">&gt;</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;test&#34;</span>,<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>LongSerializer(),<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringSerializer()<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">// Inject some random data in it</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">long</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>0L;<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#666">&lt;</span><span style="color:#bbb"> </span>10000L;<span style="color:#bbb"> </span>i<span style="color:#666">++</span><span style="color:#bbb"> </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>Long<span style="color:#bbb"> </span>key<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">long</span><span style="color:#bbb"> </span>)<span style="color:#bbb"> </span>random.<span style="color:#b44">nextLong</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>String<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>Long.<span style="color:#b44">toString</span>(<span style="color:#bbb"> </span>key<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>btree.<span style="color:#b44">insert</span>(<span style="color:#bbb"> </span>key,<span style="color:#bbb"> </span>value<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">// Check that the tree contains all the values</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">try</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">long</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>0L;<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span><span style="color:#666">&lt;</span><span style="color:#bbb"> </span>100000L;<span style="color:#bbb"> </span>i<span style="color:#666">++</span><span style="color:#bbb"> </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>assertEquals(<span style="color:#bbb"> </span>Long.<span style="color:#b44">toString</span>(<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span>),<span style="color:#bbb"> </span>btree.<span style="color:#b44">get</span>(<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span>)<span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">catch</span><span style="color:#bbb"> </span>(<span style="color:#bbb"> </span>KeyNotFoundException<span style="color:#bbb"> </span>knfe<span style="color:#bbb"> </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>fail();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">// Let&#39;s close the BTree now</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>btree.<span style="color:#b44">close</span>();<span style="color:#bbb">
</span></span></span></code></pre></div><p>So what do we have here ?</p>
<ul>
<li>we have created a BTree</li>
<li>we have fed it with 10 000 keys and values</li>
<li>we have read all of them</li>
</ul>
<p>That&rsquo;s pretty simple ! All you have to do is to carefully create your BTree, and to provide the Key and Value serializers.</p>
<p>We will now look a little more in detail what you can do.</p>
<h2 id="btrees-and-storage">BTrees and storage</h2>
<p>A BTree knows pretty much nothing about the way the data it contains are stored. The default is to store data in memory, with a backup being done on disk regularly, so that you don&rsquo;t lose anything in case of a crash. This is what we have done in the previous example.</p>
<p>But you can also associate a <em>BTree</em> to a <em>RecordManager</em>, which will manage the storage on disk on any modification. In this case, the RecordManager will encapsulate the <em>BTree</em> (in fact, a <em>RecordManager</em> can handle more than one <em>BTree</em>). Here is how you use this feature :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#080;font-style:italic">// Create the RecordManager</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>RecordManager<span style="color:#bbb"> </span>recordManager<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>RecordManager(<span style="color:#bbb"> </span><span style="color:#b44">&#34;MyData.db&#34;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">// Delegate the creation of the BTree to the recordManager</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>BTree<span style="color:#666">&lt;</span>Long,<span style="color:#bbb"> </span>String<span style="color:#666">&gt;</span><span style="color:#bbb"> </span>btree<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>recordManager1.<span style="color:#b44">addBTree</span>(<span style="color:#bbb"> </span><span style="color:#b44">&#34;test&#34;</span>,<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>LongSerializer(),<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringSerializer(),<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">// Do whatever you want with the BTree now...</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">// Close the RecordManager. It will close all the associated BTrees</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>recordManager.<span style="color:#b44">close</span>();<span style="color:#bbb">
</span></span></span></code></pre></div><p>Here, all the modifications will be stored on disk, and in an efficient way.</p>
<h2 id="operations-on-a-btree">Operations on a BTree</h2>
<p>The type of operations you can conduct on a <em>Btree</em> are listed below (for the most useful ones )</p>
<ul>
<li>browse : allow a user to browse the full <em>BTree</em> up and down</li>
<li>contains : tells if a <em>BTree</em> contains a specific key and value</li>
<li>delete : delete from a <em>BTree</em></li>
<li>get : return a value from a key</li>
<li>hasKey : tells if the <em>BTree</em> contains a specific key</li>
<li>insert : inject a new key and values in a <em>BTree</em></li>
</ul>
<p>You will find a detailed description of all the associated methods in the Mavibot javadoc.</p>
<h2 id="values">Values</h2>
<p>A <em>BTree</em> can store single value or multiple values, associated to a key. The <em>AllowDuplicates</em> flags is set to true if you want to store multiple values associated with one key.</p>
<p>The default <em>BTree</em> will only accept single value.</p>
<h2 id="revisions">Revisions</h2>
<p>Your <em>BTree</em> can store a new revision for each new modification done on it. Those revisions are kept until no operation are holding them. The <em>BTree</em> operations can all be done using a specific revision number.</p>
<p>Once the revision is not longer in use, the associated pages are likely to be reclaimed.</p>
<h2 id="cache">Cache</h2>
<p>We don&rsquo;t implement a cache : we depends on Java for that. The <em>BTree</em> is stored in memory, using class instances, and are eventually loaded from disk if they are not present in memory. We use <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/ref/WeakReference.html"><em>WeakReference</em></a> to hold all the pages.</p>
<p>As the <em>Java</em> garbage collector already keeps in memory the most frequently used data, it&rsquo;s likely that the important pages - ie, the top of each <em>BTree</em> - will be kept in memory.</p>


            

        </div>
        <div id="endContent"></div>
    </div>

    <div class="footer-wrapper">
<div id="footer">
    &copy; 2003-2025, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache Directory, ApacheDS, Apache Directory Server, Apache Directory Studio, Apache LDAP API, Apache Triplesec,
    Triplesec, Apache Mavibot, Mavibot, Apache eSCIMo, eSCIMo, Apache SCIMple, SCIMple, Fortress, Apache Fortress, EnMasse,
    Apache EnMasse, Apache Kerby, Kerby, Apache, the Apache feather logo, and the Apache Directory project logos are
    trademarks of The Apache Software Foundation.
</div>
</div>

</div>
<div class="top-bottom-spacer"></div>
</body>

</html>
